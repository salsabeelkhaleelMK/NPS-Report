Thought for 3s# NPS CAMPAIGN MANAGER - COMPLETE PROJECT SPECIFICATION

## PROJECT OVERVIEW

Build a comprehensive NPS (Net Promoter Score) campaign management platform for automotive CRM with campaign creation, configuration, insights tracking, and AI-powered follow-ups. The application manages customer satisfaction surveys with intelligent routing based on NPS scores and automated action triggers.

---

## CORE DATA STRUCTURES

### Campaign Type

```plaintext
Campaign {
  id: string (unique)
  name: string
  description: string
  language: "EN" | "DE" | "AR"
  serviceType: "New Vehicle Purchase" | "Service Visit" | "Parts Purchase" | "Financing" | "Leasing"
  status: "Active" | "Paused" | "Draft" | "Completed"
  startDate: Date
  endDate: Date
  targetAudience: string
  triggerType: "Immediate" | "Delayed"
  delayHours: number
  dataSource: string
  
  surveyQuestions: SurveyQuestion[]
  followUpSteps: FollowUpStep[]
  messageTemplates: MessageTemplate
  reviewChannels: ReviewChannel[]
  outcomeRules: OutcomeRules
  aiAgentSettings: AIAgentSettings
  
  insights: CampaignInsights
  createdAt: Date
  updatedAt: Date
}
```

### Survey Question

```plaintext
SurveyQuestion {
  id: string
  type: "Yes/No" | "Grade" | "Text" | "Rating"
  text: string
  required: boolean
  order: number
}
```

### Follow-up Step

```plaintext
FollowUpStep {
  id: string
  order: number
  actionType: "Send Email" | "Send SMS" | "Send AI Call" | "Create dispute on Fidspark" | "Create NPS Task on Leadspark" | "Create follow-up task via Webhook"
  delayDays: number
  configuration: object (varies by action type)
}
```

### Message Template

```plaintext
MessageTemplate {
  email: {
    subject: string
    body: string
  }
  sms: {
    body: string
  }
  whatsapp: {
    template: string
  }
}
```

### Outcome Rules

```plaintext
OutcomeRules {
  detractors: {
    createFidsparkDispute: boolean
    createLeadsparkTask: boolean
    createWebhookTask: boolean
    webhookUrl: string
    webhookSecret: string
    webhookPayloadTemplate: string
  }
  promoters: {
    promptReviewChannels: boolean
  }
  passives: {
    noAction: boolean
  }
}
```

### Review Channel

```plaintext
ReviewChannel {
  id: string
  platform: "Google" | "Facebook" | "AutoScout24" | "mobile.de"
  priority: number
  enabled: boolean
}
```

### AI Agent Settings

```plaintext
AIAgentSettings {
  enabled: boolean
  startAfterHours: number
  retryIntervalHours: number
  callWindowFrom: string (HH:mm)
  callWindowTo: string (HH:mm)
  maxRetries: number
  voiceType: "Male 1" | "Male 2" | "Female 1" | "Female 2" | "Neutral"
  personaScript: string
  triggerHumanFollowUpOnFailure: boolean
  triggerHumanFollowUpOnDissatisfaction: boolean
  triggerHumanFollowUpOnVerbalComplaint: boolean
}
```

### Campaign Insights

```plaintext
CampaignInsights {
  npsScore: number (0-100)
  responseCount: number
  responseRate: number
  promotersPercent: number
  passivesPercent: number
  detractorsPercent: number
  responseSources: {
    email: number
    sms: number
    aiCall: number
  }
  npsOverTime: Array<{ date: Date, score: number }>
  
  aiAgentMetrics: {
    totalCalls: number
    successfulCalls: number
    unreachable: number
    avgCallDuration: number
    escalationReasons: Array<{ reason: string, count: number }>
  }
  
  reviewPerformance: {
    totalReviewRequestsSent: number
    clickRate: number
    clicksByChannel: Array<{ channel: string, clicks: number }>
    clicksByPlatform: Array<{ platform: string, clicks: number }>
    engagementRate: number
    engagementTrend: Array<{ date: Date, rate: number }>
  }
  
  detractorTickets: Array<{
    id: string
    customerName: string
    issue: string
    status: "Open" | "In Progress" | "Resolved"
    actionTaken: string
    createdAt: Date
  }>
}
```

---

## UI/UX & DESIGN SYSTEM

### Color Palette

- **Primary:** Blue (`#2563eb`) for interactive elements
- **Neutrals:** Slate-50 (bg), Slate-100 (hover), Slate-300 (disabled), Slate-400 (tertiary), Slate-600 (secondary), Slate-900 (primary text)
- **Status Colors:** Green (Active), Amber (Paused), Gray (Draft), Blue (Completed)


### Typography Scale

- **24px / 600** - Page titles
- **18px / 600** - Section headers
- **16px / 500** - Subsection headers
- **14px / 400** - Body text
- **12px / 400** - Captions/meta


### Layout Principles

- **No sidebar navigation** - Campaigns page is entry point
- **Cards instead of tables** - All lists use card UI
- **Progressive disclosure** - Show essential info, reveal on interaction
- **Proper spacing:** 24px between sections, 8px within groups
- **Tabs:** No rounded corners, selected = black bg + white text


---

## PAGES & ROUTES

### 1. Home Page (`/`)

- Redirect to `/campaigns`


### 2. Campaigns List (`/campaigns`)

- **Hero section:** "Campaigns" title with "Create New Campaign" button
- **Search bar:** Single unified search across name, language, serviceType, status, description
- **Campaign cards** (progressive disclosure):

- Primary: Campaign name, status badge, NPS score
- On hover: Show navigation arrow
- Click: Navigate to detail page or open settings



- **Empty state:** When no campaigns exist


### 3. Create Campaign (`/campaigns/new`)

- **Full-width wizard** with 5 steps, no max-width constraint
- **Step indicator:** Numbered with connecting lines, titles below icons
- **All form fields:** Full width of container


**Step 1: Campaign Setup**

- Name, Description, Language, Service Type
- Start Date, End Date


**Step 2: Audience & Trigger**

- Target Audience
- Trigger Type (Immediate/Delayed)
- Data Source
- Delay Hours (if delayed)


**Step 3: Survey & Templates**

- Survey Questions (add/edit/delete with types)
- Message Templates (Email subject/body, SMS, WhatsApp)


**Step 4: Outcomes & Reviews**

- Outcome Rules (Detractors/Promoters/Passives config)
- Review Channels (drag-to-reorder priority, platform selection)


**Step 5: Advanced Options**

- Follow-up Flow (drag-and-drop reorderable steps)
- AI Agent Configuration (optional, collapsible)
- Final review summary
- Launch button


**Features:**

- Service type change prompts question replacement
- Default questions auto-loaded per service type
- Detractor actions validation (at least 1 required)
- All data persists in localStorage


### 4. Campaign Detail (`/campaigns/[id]`)

- **Header:** Campaign name, status badge, back button, settings button
- **Insights Dashboard:** Single scrollable page with collapsible sections


**Section 1: NPS Overview**

- Large NPS donut chart (color-coded status)
- Distribution bars (Promoters %, Passives %, Detractors %)
- Key metrics: Response count, response rate


**Section 2: Response Sources**

- Breakdown by channel (email, SMS, AI calls)


**Section 3: NPS Trend**

- Line chart showing NPS score over time


**Section 4: Review Performance** (Collapsible)

- Review requests sent count
- Click rate percentage
- Clicks by delivery channel (Email, SMS, WhatsApp)
- Clicks by platform (Google, Facebook, AutoScout24, mobile.de)
- Engagement rate and trend


**Section 5: AI Agent Insights** (Collapsible)

- Total calls, successful calls, unreachable
- Average call duration
- Escalation reasons summary


**Section 6: Detractor Cases** (Collapsible)

- Table of detractor tickets with customer name, issue, status, action taken
- Status badges


### 5. Campaign Settings (`/campaigns/[id]/settings`)

- **Drawer panel** (max-width: 448px)
- **Tabs:** No rounded corners, black bg for selected, sharp edges
- **Default:** All accordion sections closed


**Basics Tab** (Accordion sections):

1. Basic Information

1. Name, Description, Language, Service Type, Status
2. Start/End dates, Target Audience, Trigger config



2. Survey Questions (with drag reorder)
3. Follow-up Flow (with drag-and-drop)
4. Message Templates


**Outcomes Tab** (Accordion sections):

1. Outcome Rules (Detractors/Promoters/Passives)
2. Review Channels (with drag-to-reorder)


**AI Agent Tab:**

- Full AI agent configuration (not collapsible)


**All input fields:** White background (`bg-white`)
**All action buttons:** Black background (`bg-slate-900`)

---

## KEY FEATURES

### 1. Service-Type-Specific Questions

- **Default questions per service type** (New Vehicle Purchase, Service Visit, Parts Purchase, Financing, Leasing)
- **Auto-update on service type change** with confirmation dialog
- **Users can customize** questions at any time


### 2. Follow-up Flow Builder

- **Drag-and-drop reordering** of steps
- **Multiple action types:** Email, SMS, AI Call, Fidspark, Leadspark, Webhook
- **Delay configuration** between steps
- **Webhook support** with URL, secret, JSON template


### 3. Outcome Logic

- **Detractors (0-6):** At least 1 action required (Fidspark, Leadspark, or Webhook)
- **Promoters (9-10):** Review channel selection with priority ordering
- **Passives (7-8):** No action by default
- **AI escalation:** Trigger human follow-up on failure, dissatisfaction, or complaints


### 4. Review Platform Management

- **Drag-and-drop priority** ordering
- **Delivery channel config** (Email, SMS, WhatsApp) with priority
- **Message templates** with placeholders
- **Platform tracking:** Google, Facebook, AutoScout24, mobile.de


### 5. AI Agent Integration

- **Enable/disable toggle**
- **Call scheduling:** Start delay, retry interval, call window (FROM/TO)
- **Voice selection** (5 options)
- **Persona script** configuration
- **Escalation triggers:** Failure, dissatisfaction, verbal complaints
- **Call tracking:** Count, duration, success rate, unreachable customers


### 6. Campaign Insights

- **Real-time NPS score** calculation
- **Response breakdown** by source (email, SMS, AI)
- **Promoter/Passive/Detractor %** distribution
- **Review performance tracking:** Requests, clicks, engagement by platform/channel
- **AI metrics:** Call stats, escalation reasons
- **Detractor ticket management** with status tracking
- **Historical trend data** (NPS, engagement over time)


### 7. Data Persistence

- **localStorage-based store** with localStorage keys
- **Unique campaign IDs** (UUID-like strings)
- **Seed data:** 3 default campaigns (EN, DE, AR) with different statuses and dates


---

## DEFAULT SAMPLE DATA

### Three Seed Campaigns

1. **English Campaign** - Active status, 30 days ago → tomorrow, NPS 72
2. **German Campaign** - Completed status, 60 days ago → yesterday, NPS 68
3. **Arabic Campaign** - Draft status, 30 days future → 60 days future, NPS 0


### Each Campaign Includes

- Sample insights (NPS, response rates, AI metrics, detractor tickets)
- Sample questions (customized per service type)
- Sample message templates
- Sample outcome rules
- Sample AI agent config
- Sample follow-up flow
- Sample review channels


---

## TECHNICAL REQUIREMENTS

### Stack

- **Framework:** Next.js 16 (App Router)
- **UI Components:** shadcn/ui (Button, Input, Textarea, Select, Tabs, Accordion, Dialog, etc.)
- **Styling:** Tailwind CSS v4
- **State Management:** React hooks + localStorage
- **Drag-and-Drop:** @dnd-kit/core + @dnd-kit/sortable
- **Icons:** Lucide React
- **Data Persistence:** localStorage with JSON serialization


### Project Structure

```plaintext
app/
  layout.tsx
  globals.css
  page.tsx (redirect to /campaigns)
  campaigns/
    page.tsx (list)
    new/page.tsx (create wizard)
    [id]/
      page.tsx (detail + insights)
      settings/page.tsx (settings drawer)

components/
  layout/
    main-layout.tsx
  campaigns/
    campaign-list.tsx
    campaign-card.tsx
    wizard/
      campaign-wizard.tsx
      wizard-context.tsx
      step-setup.tsx
      step-audience.tsx
      step-survey-templates.tsx
      step-outcomes-reviews.tsx
      step-advanced.tsx
    insights/
      campaign-insights-dashboard.tsx
      nps-insights.tsx
      review-performance.tsx
      ai-agent-insights.tsx
      detractor-cases.tsx
    settings/
      campaign-settings-drawer.tsx
      basics-settings.tsx
      survey-questions-settings.tsx
      message-templates-settings.tsx
      followup-settings.tsx
      outcome-rules-settings.tsx
      review-channels-settings.tsx
      ai-agent-settings.tsx
  ui/
    status-badge.tsx
    (other shadcn components)

lib/
  types.ts (all TypeScript types)
  store.ts (localStorage management + seed data)
  utils.ts (helpers)
```

---

## VALIDATION & ENFORCEMENT

1. **Detractor Actions:** At least one must be enabled; error if none selected
2. **Service Type Change:** Confirmation dialog when changing with existing questions
3. **Follow-up Steps:** Can add, delete, reorder; at least one required for follow-up flow
4. **AI Agent:** Optional but if enabled, validates call window times
5. **Form Fields:** All required fields marked; validation on save


---

## PERFORMANCE & UX CONSIDERATIONS

- **Progressive disclosure:** Campaign cards show minimal info, expand on hover
- **Lazy loading:** Insights load only when campaign detail opened
- **Debounced search:** Campaign list search debounced 300ms
- **Undo/Redo:** Not required but welcome enhancement
- **Keyboard shortcuts:** Tab navigation works throughout
- **Accessibility:** ARIA labels, semantic HTML, color contrast compliance


---

## FUTURE ENHANCEMENTS (Optional)

- Export campaigns to CSV
- Bulk campaign actions
- Scheduling campaigns in advance
- Real-time webhook integration
- Email integration for message sending
- SMS gateway integration
- Call recording playback for AI calls
- A/B testing different templates
- Advanced analytics and reporting
- Multi-user support with permissions
- API integration for external systems


---

This specification contains everything needed to recreate the NPS Campaign Manager project exactly as built, including all data structures, pages, components, features, design system, and implementation details.