
## PROJECT OVERVIEW

Build a comprehensive NPS (Net Promoter Score) campaign management platform for automotive CRM with campaign creation, configuration, insights tracking, and AI-powered follow-ups. The application manages customer satisfaction surveys with intelligent routing based on NPS scores and automated action triggers.
---
# NPS Campaign Manager

## Overview

The NPS Campaign Manager is an enterprise-grade automotive CRM application designed to create, manage, and analyze Net Promoter Score (NPS) campaigns. The platform enables automotive businesses to collect customer feedback through multi-channel surveys (email, SMS, WhatsApp, AI-powered calls), track engagement metrics, and automate follow-up actions based on customer responses. The system focuses on measuring customer satisfaction across various touchpoints including new vehicle purchases, service visits, parts purchases, financing, and leasing interactions.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture

**Framework & Build System**
- React 18+ with TypeScript for type safety and developer experience
- Vite as the build tool and development server for fast HMR (Hot Module Replacement)
- Client-side routing using Wouter for lightweight navigation
- Single Page Application (SPA) architecture with client-side state management

**UI Component System**
- Radix UI primitives for accessible, unstyled components (dialogs, dropdowns, accordions, tabs, etc.)
- Shadcn/ui component library configured in "new-york" style
- Tailwind CSS for utility-first styling with custom design tokens
- Material Design principles adapted for automotive CRM workflows
- Design system emphasizes clarity and efficiency for data-heavy enterprise use

**State Management**
- TanStack Query (React Query) for server state management, caching, and API interactions
- Local storage-based campaign store (`client/src/lib/campaignStore.ts`) for demo/development purposes
- Custom hooks for toast notifications and mobile responsiveness

**Form Handling & Validation**
- React Hook Form with Hookform Resolvers for form state management
- Zod schemas for runtime validation
- Drag-and-drop functionality via @dnd-kit for reorderable lists (survey questions, follow-up steps)

**Data Visualization**
- Recharts library for NPS trend charts, donut charts, and distribution visualizations
- Custom chart components for campaign insights and analytics

### Backend Architecture

**Runtime & Server**
- Node.js with Express.js framework
- TypeScript throughout for type consistency
- HTTP server created via Node's `http` module
- Development mode uses Vite middleware for HMR integration

**API Design**
- RESTful API architecture (routes defined in `server/routes.ts`)
- All application routes prefixed with `/api`
- Static file serving for production builds via Express static middleware
- SPA fallback routing to `index.html` for client-side navigation

**Storage Interface**
- Abstracted storage layer via `IStorage` interface in `server/storage.ts`
- In-memory storage implementation (`MemStorage`) for development/demo
- Designed for easy migration to database-backed storage
- CRUD operations for campaigns, users, and related entities

### Data Storage

**Database Configuration**
- PostgreSQL as the target production database
- Drizzle ORM for type-safe database queries and migrations
- Neon serverless PostgreSQL driver (`@neondatabase/serverless`) for cloud deployment
- Schema definitions in `shared/schema.ts` using Drizzle's schema builder

**Schema Design**
- User authentication schema with username/password fields
- Campaign data model includes: basic info, survey questions, follow-up steps, message templates, review channels, outcome rules, AI agent settings, and insights
- Shared schema between client and server for type consistency

**Session Management**
- Express-session for session handling
- Connect-pg-simple for PostgreSQL-backed session storage
- Memorystore as fallback for development without database

### Authentication & Authorization

**Strategy**
- Passport.js with local strategy for username/password authentication
- Express sessions for maintaining user login state
- Cookie-based session management with credentials included in API requests

**Security Considerations**
- Password hashing (implementation expected via bcrypt or similar)
- CSRF protection via session configuration
- Environment-based secret management for session keys and database credentials

### External Dependencies

**Third-Party Services & APIs**
- **AI Integration**: OpenAI API and Google Generative AI for AI-powered customer follow-ups and conversation handling
- **Email Service**: Nodemailer for email notifications and campaign delivery
- **Payment Processing**: Stripe integration for potential subscription or payment features
- **File Processing**: XLSX library for importing/exporting campaign data and customer lists
- **WebSocket Support**: WS library for real-time updates (potential use for live dashboard updates)

**Database & Infrastructure**
- Neon serverless PostgreSQL for cloud-hosted database
- Environment variable configuration via `DATABASE_URL`
- Drizzle Kit for database migrations and schema management

**Development Tools**
- Replit-specific plugins for development experience (@replit/vite-plugin-runtime-error-modal, cartographer, dev-banner)
- Express Rate Limit for API throttling and abuse prevention
- CORS middleware for cross-origin resource sharing

**Styling & Design**
- Tailwind CSS with custom configuration for design tokens
- PostCSS with Autoprefixer for CSS processing
- Custom fonts: DM Sans, Architects Daughter, Fira Code, Geist Mono
- Color system based on neutral slate palette with primary blue (#2563eb)

**Build & Deployment**
- ESBuild for server-side bundling with selective dependency bundling
- Vite for client-side bundling and optimization
- Production builds output to `dist/` directory with client assets in `dist/public`
- Server bundled as CommonJS (`dist/index.cjs`) for Node.js execution
---
# NPS CAMPAIGN MANAGER - DESIGN GUIDELINES

## Design Approach
**System-Based Approach**: This is a data-heavy, productivity-focused enterprise application. Using Material Design principles adapted for automotive CRM workflows with emphasis on clarity, efficiency, and actionable insights.

## Core Design Elements

### Color System
**Primary Blue**: `#2563eb` - All interactive elements, CTAs, primary actions
**Neutrals**: 
- Slate-50: Page backgrounds
- Slate-100: Hover states
- Slate-300: Disabled states
- Slate-400: Tertiary text
- Slate-600: Secondary text
- Slate-900: Primary text, selected tab backgrounds, action buttons

**Status Colors**:
- Green: Active campaigns
- Amber: Paused campaigns
- Gray: Draft campaigns
- Blue: Completed campaigns

### Typography Hierarchy
- **24px / 600**: Page titles ("Campaigns", "Campaign Detail")
- **18px / 600**: Section headers (Wizard steps, Dashboard sections)
- **16px / 500**: Subsection headers, Tab labels
- **14px / 400**: Body text, form labels, card content
- **12px / 400**: Captions, metadata, timestamps

### Layout System
**Spacing Units**: Tailwind's 8px base scale
- 24px (`p-6`): Between major sections
- 16px (`p-4`): Within cards, between form groups
- 8px (`p-2`): Within tight groupings, between labels and inputs
- 4px (`p-1`): Minimal spacing for inline elements

**Container Strategy**:
- Campaign List: Max-width container (`max-w-7xl`)
- Create Wizard: **Full-width** - no max-width constraint
- Detail Page: Full-width with internal section constraints
- Settings Drawer: Fixed 448px max-width

**Card Design**: Elevated cards with subtle shadows, rounded corners, white backgrounds. Progressive disclosure - show name/status/NPS primarily, reveal more on hover.

### Component Library

**Navigation**:
- No sidebar navigation
- Header with back buttons on detail/settings pages
- Breadcrumb-free navigation (simple back arrows)

**Tabs** (Critical Specification):
- **NO rounded corners** - sharp edges
- Selected state: Black background (`bg-slate-900`) + white text
- Unselected: Default gray with hover states
- Bottom border indicator on selected tab

**Buttons**:
- Primary actions: Black background (`bg-slate-900`)
- Buttons over images: Blurred backgrounds
- Form inputs: White backgrounds (`bg-white`)
- All buttons full-width in their containers when in forms

**Cards vs Tables**:
- **Always use cards** for campaign lists, never tables
- Cards show essential info prominently
- Hover reveals navigation arrow
- Click navigates to detail or opens settings

**Forms**:
- All inputs white background
- Labels above inputs (14px)
- Consistent spacing between form groups
- Validation states with color-coded feedback

**Accordions**:
- Default state: **All sections collapsed** in settings
- Clear expand/collapse indicators
- Smooth transitions

**Data Visualization**:
- Large NPS donut chart with color-coded segments (Promoters/Passives/Detractors)
- Horizontal distribution bars for percentages
- Line charts for trends over time
- Collapsible insight sections

**Drag & Drop**:
- Clear drag handles (6-dot icon pattern)
- Visual feedback during drag (elevated shadow, slight opacity)
- Drop zones highlighted
- Smooth reordering animations

### Wizard Design (5-Step Create Flow)
- Numbered step indicator with connecting lines
- Step titles below numbered icons
- Full-width form fields within each step
- Bottom navigation (Back/Next/Launch buttons)
- Progress saved to localStorage on each step
- Validation before advancing

### Settings Drawer
- Slide in from right
- Overlay backdrop
- Three tabs: Basics, Outcomes, AI Agent
- Accordion sections within Basics and Outcomes tabs
- Close button top-right
- Save/Cancel actions at bottom

### Empty States
- Centered content with icon
- Clear call-to-action ("Create your first campaign")
- Friendly, encouraging copy

### Progressive Disclosure
- Campaign cards: Show name/status/NPS → reveal details on hover
- Dashboard sections: Collapsible for Review Performance, AI Insights, Detractor Cases
- Settings: Accordion sections start collapsed

## Images
**No hero images required** - This is a dashboard/productivity application focused on data and workflows, not marketing content. Use icons, charts, and data visualizations instead.

## Page-Specific Guidelines

**Campaigns List**: Grid of cards, search bar at top, "Create New Campaign" button (black, prominent)

**Create Wizard**: Clean, spacious steps with generous whitespace. Full-width to accommodate complex form configurations.

**Campaign Detail**: Single scrollable page, sections clearly separated with consistent spacing. Donut chart as visual anchor.

**Settings Drawer**: Compact but not cramped, clear tab divisions, accordion for organization.

---

## CORE DATA STRUCTURES

### Campaign Type

```plaintext
Campaign {
  id: string (unique)
  name: string
  description: string
  language: "EN" | "DE" | "AR"
  serviceType: "New Vehicle Purchase" | "Service Visit" | "Parts Purchase" | "Financing" | "Leasing"
  status: "Active" | "Paused" | "Draft" | "Completed"
  startDate: Date
  endDate: Date
  targetAudience: string
  triggerType: "Immediate" | "Delayed"
  delayHours: number
  dataSource: string
  
  surveyQuestions: SurveyQuestion[]
  followUpSteps: FollowUpStep[]
  messageTemplates: MessageTemplate
  reviewChannels: ReviewChannel[]
  outcomeRules: OutcomeRules
  aiAgentSettings: AIAgentSettings
  
  insights: CampaignInsights
  createdAt: Date
  updatedAt: Date
}
```

### Survey Question

```plaintext
SurveyQuestion {
  id: string
  type: "Yes/No" | "Grade" | "Text" | "Rating"
  text: string
  required: boolean
  order: number
}
```

### Follow-up Step

```plaintext
FollowUpStep {
  id: string
  order: number
  actionType: "Send Email" | "Send SMS" | "Send AI Call" | "Create dispute on Fidspark" | "Create NPS Task on Leadspark" | "Create follow-up task via Webhook"
  delayDays: number
  configuration: object (varies by action type)
}
```

### Message Template

```plaintext
MessageTemplate {
  email: {
    subject: string
    body: string
  }
  sms: {
    body: string
  }
  whatsapp: {
    template: string
  }
}
```

### Outcome Rules

```plaintext
OutcomeRules {
  detractors: {
    createFidsparkDispute: boolean
    createLeadsparkTask: boolean
    createWebhookTask: boolean
    webhookUrl: string
    webhookSecret: string
    webhookPayloadTemplate: string
  }
  promoters: {
    promptReviewChannels: boolean
  }
  passives: {
    noAction: boolean
  }
}
```

### Review Channel

```plaintext
ReviewChannel {
  id: string
  platform: "Google" | "Facebook" | "AutoScout24" | "mobile.de"
  priority: number
  enabled: boolean
}
```

### AI Agent Settings

```plaintext
AIAgentSettings {
  enabled: boolean
  startAfterHours: number
  retryIntervalHours: number
  callWindowFrom: string (HH:mm)
  callWindowTo: string (HH:mm)
  maxRetries: number
  voiceType: "Male 1" | "Male 2" | "Female 1" | "Female 2" | "Neutral"
  personaScript: string
  triggerHumanFollowUpOnFailure: boolean
  triggerHumanFollowUpOnDissatisfaction: boolean
  triggerHumanFollowUpOnVerbalComplaint: boolean
}
```

### Campaign Insights

```plaintext
CampaignInsights {
  npsScore: number (0-100)
  responseCount: number
  responseRate: number
  promotersPercent: number
  passivesPercent: number
  detractorsPercent: number
  responseSources: {
    email: number
    sms: number
    aiCall: number
  }
  npsOverTime: Array<{ date: Date, score: number }>
  
  aiAgentMetrics: {
    totalCalls: number
    successfulCalls: number
    unreachable: number
    avgCallDuration: number
    escalationReasons: Array<{ reason: string, count: number }>
  }
  
  reviewPerformance: {
    totalReviewRequestsSent: number
    clickRate: number
    clicksByChannel: Array<{ channel: string, clicks: number }>
    clicksByPlatform: Array<{ platform: string, clicks: number }>
    engagementRate: number
    engagementTrend: Array<{ date: Date, rate: number }>
  }
  
  detractorTickets: Array<{
    id: string
    customerName: string
    issue: string
    status: "Open" | "In Progress" | "Resolved"
    actionTaken: string
    createdAt: Date
  }>
}
```

---

## UI/UX & DESIGN SYSTEM

### Color Palette

- **Primary:** Blue (`#2563eb`) for interactive elements
- **Neutrals:** Slate-50 (bg), Slate-100 (hover), Slate-300 (disabled), Slate-400 (tertiary), Slate-600 (secondary), Slate-900 (primary text)
- **Status Colors:** Green (Active), Amber (Paused), Gray (Draft), Blue (Completed)


### Typography Scale

- **24px / 600** - Page titles
- **18px / 600** - Section headers
- **16px / 500** - Subsection headers
- **14px / 400** - Body text
- **12px / 400** - Captions/meta


### Layout Principles

- **No sidebar navigation** - Campaigns page is entry point
- **Cards instead of tables** - All lists use card UI
- **Progressive disclosure** - Show essential info, reveal on interaction
- **Proper spacing:** 24px between sections, 8px within groups
- **Tabs:** No rounded corners, selected = black bg + white text


---

## PAGES & ROUTES

### 1. Home Page (`/`)

- Redirect to `/campaigns`


### 2. Campaigns List (`/campaigns`)

- **Hero section:** "Campaigns" title with "Create New Campaign" button
- **Search bar:** Single unified search across name, language, serviceType, status, description
- **Campaign cards** (progressive disclosure):

- Primary: Campaign name, status badge, NPS score
- On hover: Show navigation arrow
- Click: Navigate to detail page or open settings



- **Empty state:** When no campaigns exist


### 3. Create Campaign (`/campaigns/new`)

- **Full-width wizard** with 5 steps, no max-width constraint
- **Step indicator:** Numbered with connecting lines, titles below icons
- **All form fields:** Full width of container


**Step 1: Campaign Setup**

- Name, Description, Language, Service Type
- Start Date, End Date


**Step 2: Audience & Trigger**

- Target Audience
- Trigger Type (Immediate/Delayed)
- Data Source
- Delay Hours (if delayed)


**Step 3: Survey & Templates**

- Survey Questions (add/edit/delete with types)
- Message Templates (Email subject/body, SMS, WhatsApp)


**Step 4: Outcomes & Reviews**

- Outcome Rules (Detractors/Promoters/Passives config)
- Review Channels (drag-to-reorder priority, platform selection)


**Step 5: Advanced Options**

- Follow-up Flow (drag-and-drop reorderable steps)
- AI Agent Configuration (optional, collapsible)
- Final review summary
- Launch button


**Features:**

- Service type change prompts question replacement
- Default questions auto-loaded per service type
- Detractor actions validation (at least 1 required)
- All data persists in localStorage


### 4. Campaign Detail (`/campaigns/[id]`)

- **Header:** Campaign name, status badge, back button, settings button
- **Insights Dashboard:** Single scrollable page with collapsible sections


**Section 1: NPS Overview**

- Large NPS donut chart (color-coded status)
- Distribution bars (Promoters %, Passives %, Detractors %)
- Key metrics: Response count, response rate


**Section 2: Response Sources**

- Breakdown by channel (email, SMS, AI calls)


**Section 3: NPS Trend**

- Line chart showing NPS score over time


**Section 4: Review Performance** (Collapsible)

- Review requests sent count
- Click rate percentage
- Clicks by delivery channel (Email, SMS, WhatsApp)
- Clicks by platform (Google, Facebook, AutoScout24, mobile.de)
- Engagement rate and trend


**Section 5: AI Agent Insights** (Collapsible)

- Total calls, successful calls, unreachable
- Average call duration
- Escalation reasons summary


**Section 6: Detractor Cases** (Collapsible)

- Table of detractor tickets with customer name, issue, status, action taken
- Status badges


### 5. Campaign Settings (`/campaigns/[id]/settings`)

- **Drawer panel** (max-width: 448px)
- **Tabs:** No rounded corners, black bg for selected, sharp edges
- **Default:** All accordion sections closed


**Basics Tab** (Accordion sections):

1. Basic Information

1. Name, Description, Language, Service Type, Status
2. Start/End dates, Target Audience, Trigger config



2. Survey Questions (with drag reorder)
3. Follow-up Flow (with drag-and-drop)
4. Message Templates


**Outcomes Tab** (Accordion sections):

1. Outcome Rules (Detractors/Promoters/Passives)
2. Review Channels (with drag-to-reorder)


**AI Agent Tab:**

- Full AI agent configuration (not collapsible)


**All input fields:** White background (`bg-white`)
**All action buttons:** Black background (`bg-slate-900`)

---

## KEY FEATURES

### 1. Service-Type-Specific Questions

- **Default questions per service type** (New Vehicle Purchase, Service Visit, Parts Purchase, Financing, Leasing)
- **Auto-update on service type change** with confirmation dialog
- **Users can customize** questions at any time


### 2. Follow-up Flow Builder

- **Drag-and-drop reordering** of steps
- **Multiple action types:** Email, SMS, AI Call, Fidspark, Leadspark, Webhook
- **Delay configuration** between steps
- **Webhook support** with URL, secret, JSON template


### 3. Outcome Logic

- **Detractors (0-6):** At least 1 action required (Fidspark, Leadspark, or Webhook)
- **Promoters (9-10):** Review channel selection with priority ordering
- **Passives (7-8):** No action by default
- **AI escalation:** Trigger human follow-up on failure, dissatisfaction, or complaints


### 4. Review Platform Management

- **Drag-and-drop priority** ordering
- **Delivery channel config** (Email, SMS, WhatsApp) with priority
- **Message templates** with placeholders
- **Platform tracking:** Google, Facebook, AutoScout24, mobile.de


### 5. AI Agent Integration

- **Enable/disable toggle**
- **Call scheduling:** Start delay, retry interval, call window (FROM/TO)
- **Voice selection** (5 options)
- **Persona script** configuration
- **Escalation triggers:** Failure, dissatisfaction, verbal complaints
- **Call tracking:** Count, duration, success rate, unreachable customers


### 6. Campaign Insights

- **Real-time NPS score** calculation
- **Response breakdown** by source (email, SMS, AI)
- **Promoter/Passive/Detractor %** distribution
- **Review performance tracking:** Requests, clicks, engagement by platform/channel
- **AI metrics:** Call stats, escalation reasons
- **Detractor ticket management** with status tracking
- **Historical trend data** (NPS, engagement over time)


### 7. Data Persistence

- **localStorage-based store** with localStorage keys
- **Unique campaign IDs** (UUID-like strings)
- **Seed data:** 3 default campaigns (EN, DE, AR) with different statuses and dates


---

## DEFAULT SAMPLE DATA

### Three Seed Campaigns

1. **English Campaign** - Active status, 30 days ago → tomorrow, NPS 72
2. **German Campaign** - Completed status, 60 days ago → yesterday, NPS 68
3. **Arabic Campaign** - Draft status, 30 days future → 60 days future, NPS 0


### Each Campaign Includes

- Sample insights (NPS, response rates, AI metrics, detractor tickets)
- Sample questions (customized per service type)
- Sample message templates
- Sample outcome rules
- Sample AI agent config
- Sample follow-up flow
- Sample review channels


---

## TECHNICAL REQUIREMENTS

### Stack

- **Framework:** Next.js 16 (App Router)
- **UI Components:** shadcn/ui (Button, Input, Textarea, Select, Tabs, Accordion, Dialog, etc.)
- **Styling:** Tailwind CSS v4
- **State Management:** React hooks + localStorage
- **Drag-and-Drop:** @dnd-kit/core + @dnd-kit/sortable
- **Icons:** Lucide React
- **Data Persistence:** localStorage with JSON serialization


### Project Structure

```plaintext
app/
  layout.tsx
  globals.css
  page.tsx (redirect to /campaigns)
  campaigns/
    page.tsx (list)
    new/page.tsx (create wizard)
    [id]/
      page.tsx (detail + insights)
      settings/page.tsx (settings drawer)

components/
  layout/
    main-layout.tsx
  campaigns/
    campaign-list.tsx
    campaign-card.tsx
    wizard/
      campaign-wizard.tsx
      wizard-context.tsx
      step-setup.tsx
      step-audience.tsx
      step-survey-templates.tsx
      step-outcomes-reviews.tsx
      step-advanced.tsx
    insights/
      campaign-insights-dashboard.tsx
      nps-insights.tsx
      review-performance.tsx
      ai-agent-insights.tsx
      detractor-cases.tsx
    settings/
      campaign-settings-drawer.tsx
      basics-settings.tsx
      survey-questions-settings.tsx
      message-templates-settings.tsx
      followup-settings.tsx
      outcome-rules-settings.tsx
      review-channels-settings.tsx
      ai-agent-settings.tsx
  ui/
    status-badge.tsx
    (other shadcn components)

lib/
  types.ts (all TypeScript types)
  store.ts (localStorage management + seed data)
  utils.ts (helpers)
```

---

## VALIDATION & ENFORCEMENT

1. **Detractor Actions:** At least one must be enabled; error if none selected
2. **Service Type Change:** Confirmation dialog when changing with existing questions
3. **Follow-up Steps:** Can add, delete, reorder; at least one required for follow-up flow
4. **AI Agent:** Optional but if enabled, validates call window times
5. **Form Fields:** All required fields marked; validation on save


---

## PERFORMANCE & UX CONSIDERATIONS

- **Progressive disclosure:** Campaign cards show minimal info, expand on hover
- **Lazy loading:** Insights load only when campaign detail opened
- **Debounced search:** Campaign list search debounced 300ms
- **Undo/Redo:** Not required but welcome enhancement
- **Keyboard shortcuts:** Tab navigation works throughout
- **Accessibility:** ARIA labels, semantic HTML, color contrast compliance


---

## FUTURE ENHANCEMENTS (Optional)

- Export campaigns to CSV
- Bulk campaign actions
- Scheduling campaigns in advance
- Real-time webhook integration
- Email integration for message sending
- SMS gateway integration
- Call recording playback for AI calls
- A/B testing different templates
- Advanced analytics and reporting
- Multi-user support with permissions
- API integration for external systems


---

This specification contains everything needed to recreate the NPS Campaign Manager project exactly as built, including all data structures, pages, components, features, design system, and implementation details.