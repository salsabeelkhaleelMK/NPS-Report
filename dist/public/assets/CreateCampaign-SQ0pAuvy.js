import{j as e,r as J,s as X,t as Ne,g as ke,O as Z,h as ee,i as we,k as se,l as ae,m as Se}from"./vendor-radix-C_vsl6Su.js";import{r as C}from"./vendor-react--0RGCJ5T.js";import{c as E,a as U,X as Ce,u as Te,b as Re,I as y,C as Fe}from"./index-CQwUKZm9.js";import{B as v,D as q,v as L,c as De,P as V}from"./campaignStore-Ccqe-oHN.js";import{h as Ue,A as z,L as r,f as g,T as A,e as $,S as N,a as k,b as w,c as S,d as n,D as B,g as G,C as Ae}from"./DraggableList-DCee_3wi.js";import{C as j}from"./card-deHKyo5c.js";import"./vendor-utils-DlWX2jwD.js";import"./vendor-dnd-CP4G9cd3.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=E("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=E("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=E("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=E("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=E("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=E("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Q=C.forwardRef(({className:o,...c},i)=>e.jsx(J,{className:U("grid gap-2",o),...c,ref:i}));Q.displayName=J.displayName;const T=C.forwardRef(({className:o,...c},i)=>e.jsx(X,{ref:i,className:U("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),...c,children:e.jsx(Ne,{className:"flex items-center justify-center",children:e.jsx(Le,{className:"h-2.5 w-2.5 fill-current text-current"})})}));T.displayName=X.displayName;function Pe({steps:o,currentStep:c,onStepClick:i}){return e.jsx("div",{className:"flex items-center justify-center w-full","data-testid":"step-indicator",children:o.map((f,a)=>{const P=f.id<c,M=f.id===c,D=i&&(P||f.id<=c);return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{type:"button",onClick:()=>D&&(i==null?void 0:i(f.id)),disabled:!D,className:`
                  flex items-center justify-center w-10 h-10 rounded-full border-2 
                  transition-all text-sm font-semibold
                  ${P||M?"bg-primary border-primary text-white":"bg-white border-gray-200 text-gray-400"}
                  ${D?"cursor-pointer hover:opacity-90":"cursor-default"}
                `,"data-testid":`button-step-${f.id}`,children:P?e.jsx(Ue,{className:"h-5 w-5"}):f.id}),e.jsx("span",{className:`
                  mt-2 text-xs font-medium text-center max-w-[80px]
                  ${M?"text-gray-900":"text-gray-500"}
                `,children:f.title})]}),a<o.length-1&&e.jsx("div",{className:`
                  w-16 h-0.5 mx-2 mt-[-20px]
                  ${f.id<c?"bg-primary":"bg-gray-200"}
                `})]},f.id)})})}const Ve=ke,He=Se,te=C.forwardRef(({className:o,...c},i)=>e.jsx(Z,{ref:i,className:U("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...c}));te.displayName=Z.displayName;const re=C.forwardRef(({className:o,children:c,...i},f)=>e.jsxs(He,{children:[e.jsx(te,{}),e.jsxs(ee,{ref:f,className:U("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...i,children:[c,e.jsxs(we,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));re.displayName=ee.displayName;const le=({className:o,...c})=>e.jsx("div",{className:U("flex flex-col space-y-1.5 text-center sm:text-left",o),...c});le.displayName="DialogHeader";const ie=({className:o,...c})=>e.jsx("div",{className:U("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",o),...c});ie.displayName="DialogFooter";const de=C.forwardRef(({className:o,...c},i)=>e.jsx(se,{ref:i,className:U("text-lg font-semibold leading-none tracking-tight",o),...c}));de.displayName=se.displayName;const ne=C.forwardRef(({className:o,...c},i)=>e.jsx(ae,{ref:i,className:U("text-sm text-muted-foreground",o),...c}));ne.displayName=ae.displayName;const K=[{id:1,title:"Setup"},{id:2,title:"Timeline"},{id:3,title:"Leads source"},{id:4,title:"Survey"},{id:5,title:"Outcomes"}],Me=["Send Email","Send SMS","Send AI Call","Create dispute on Fidspark","Create NPS Task on Leadspark","Create follow-up task via Webhook"],R=[{id:"ls-1",name:"Customer Satisfaction Survey",description:"Standard NPS survey for post-purchase feedback"},{id:"ls-2",name:"Service Quality Survey",description:"Service visit feedback collection"},{id:"ls-3",name:"Product Feedback Survey",description:"New vehicle purchase experience"},{id:"ls-4",name:"Follow-up Reminder",description:"Gentle reminder for pending surveys"}],F=[{id:"fs-1",name:"Dispute Resolution Survey",description:"Feedback after dispute resolution"},{id:"fs-2",name:"Complaint Follow-up",description:"Post-complaint satisfaction check"},{id:"fs-3",name:"Escalation Feedback",description:"Feedback after escalation handling"},{id:"fs-4",name:"Recovery Survey",description:"Customer recovery experience"}],Qe={name:"",description:"",language:"EN",serviceType:"New Vehicle Purchase",triggerSourceType:"leadspark",triggerSourceWebhookUrl:"",status:"Draft",startDate:new Date,endDate:new Date(Date.now()+30*24*60*60*1e3),endDateEnabled:!1,targetAudience:"",triggerType:"Immediate",delayHours:0,dataSource:"",dataSourceType:"leadspark",externalCrmUrl:"",questionSourceType:"leadspark",externalQuestionSourceUrl:"",selectedSurveyId:R[0].id,surveyQuestions:q["New Vehicle Purchase"].map(o=>({...o,id:L()})),followUpSteps:[{id:L(),order:1,actionType:"Send AI Call",delayDays:0,configuration:{}}],messageTemplates:{email:{subject:"",body:""},sms:{body:""},whatsapp:{template:""}},outcomeRules:{detractors:{createFidsparkDispute:!1,createLeadsparkTask:!1,createWebhookTask:!1,webhookUrl:"",webhookSecret:"",webhookPayloadTemplate:""},nonResponders:{createFidsparkDispute:!1,createLeadsparkTask:!1,createWebhookTask:!1},promoters:{notifyFidspark:!1},passives:{noAction:!0}},aiAgentSettings:{enabled:!1,startAfterHours:24,retryIntervalHours:4,callWindowFrom:"09:00",callWindowTo:"18:00",maxRetries:3,voiceType:"Female 1",personaScript:"",triggerHumanFollowUpOnFailure:!1,triggerHumanFollowUpOnDissatisfaction:!1,triggerHumanFollowUpOnVerbalComplaint:!1},insights:{npsScore:0,responseCount:0,responseRate:0,promotersPercent:0,passivesPercent:0,detractorsPercent:0,responseSources:{email:0,sms:0,aiCall:0},npsOverTime:[],aiAgentMetrics:{totalCalls:0,successfulCalls:0,unreachable:0,avgCallDuration:0,escalationReasons:[]},detractorTickets:[],detractorTasks:[]}};function Ye(){const[,o]=Te(),{toast:c}=Re(),[i,f]=C.useState(1),[a,P]=C.useState(Qe),[M,D]=C.useState(!1),[W,O]=C.useState(null),[ce,oe]=C.useState(new Set),l=(s,d)=>{P(x=>({...x,[s]:d}))},me=s=>{s!==a.serviceType&&a.surveyQuestions.length>0?(O(s),D(!0)):(l("serviceType",s),l("surveyQuestions",q[s].map(d=>({...d,id:L()}))))},xe=()=>{W&&(l("serviceType",W),l("surveyQuestions",q[W].map(s=>({...s,id:L()})))),D(!1),O(null)},ue=()=>{const s={id:L(),type:"Rating",text:"",required:!0,order:a.surveyQuestions.length+1};l("surveyQuestions",[...a.surveyQuestions,s])},he=s=>{l("surveyQuestions",a.surveyQuestions.filter(d=>d.id!==s))},pe=()=>{const s={id:L(),order:a.followUpSteps.length+1,actionType:"Send Email",delayDays:0,configuration:{}};l("followUpSteps",[...a.followUpSteps,s])},ge=s=>{l("followUpSteps",a.followUpSteps.filter(d=>d.id!==s))},ye=s=>{oe(d=>{const x=new Set(d);return x.has(s)?x.delete(s):x.add(s),x})},m=(s,d)=>{const x=a.followUpSteps.map(u=>u.id===s?{...u,configuration:{...u.configuration,...d}}:u);l("followUpSteps",x)},p=(s,d,x="")=>{var h;const u=a.followUpSteps.find(b=>b.id===s);return((h=u==null?void 0:u.configuration)==null?void 0:h[d])??x},_=s=>{switch(s){case 1:return a.name.trim()!==""&&a.description.trim()!=="";case 2:return a.followUpSteps.length>0;case 3:return a.dataSourceType==="external_crm"?a.externalCrmUrl.trim()!=="":a.dataSourceType==="manual_upload"?a.targetAudience.trim()!=="":!0;case 4:return a.questionSourceType==="leadspark"||a.questionSourceType==="fidspark"?a.selectedSurveyId.trim()!=="":a.questionSourceType==="external"?a.externalQuestionSourceUrl.trim()!=="":a.surveyQuestions.length>0;case 5:return!0;case 6:return!0;default:return!0}},je=()=>{if(!_(i)){c({title:"Validation Error",description:"Please fill in all required fields before proceeding.",variant:"destructive"});return}i<6&&f(i+1)},be=()=>{i>1&&f(i-1)},fe=()=>{if(!_(i)){c({title:"Validation Error",description:"Please ensure all required fields are filled.",variant:"destructive"});return}const s={...a,endDate:a.endDateEnabled?a.endDate:void 0},d=De(s);c({title:"Campaign Created",description:`"${d.name}" has been created successfully.`}),o(`/campaigns/${d.id}`)},ve=()=>{switch(i){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"name",className:"text-sm font-medium text-gray-900",children:"Campaign Name *"}),e.jsx(y,{id:"name",value:a.name,onChange:s=>l("name",s.target.value),placeholder:"Enter campaign name",className:"mt-2 bg-white border-gray-200 rounded-md","data-testid":"input-campaign-name"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"description",className:"text-sm font-medium text-gray-900",children:"Description *"}),e.jsx(A,{id:"description",value:a.description,onChange:s=>l("description",s.target.value),placeholder:"Describe the purpose of this campaign",className:"mt-2 bg-white border-gray-200 rounded-md",rows:3,"data-testid":"input-campaign-description"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Language"}),e.jsxs(N,{value:a.language,onValueChange:s=>l("language",s),children:[e.jsx(k,{className:"mt-2 bg-white border-gray-200 rounded-md w-full","data-testid":"select-language",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"EN",children:"English"}),e.jsx(n,{value:"DE",children:"German"}),e.jsx(n,{value:"AR",children:"Arabic"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Start Date *"}),e.jsx(y,{type:"date",value:a.startDate.toISOString().split("T")[0],onChange:s=>l("startDate",new Date(s.target.value)),className:"mt-2 bg-white border-gray-200 rounded-md","data-testid":"input-start-date"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"End Date (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Enable"}),e.jsx(g,{checked:a.endDateEnabled,onCheckedChange:s=>l("endDateEnabled",s),"data-testid":"switch-end-date-enabled"})]})]}),e.jsx(y,{type:"date",value:a.endDate.toISOString().split("T")[0],onChange:s=>l("endDate",new Date(s.target.value)),className:"bg-white border-gray-200 rounded-md",disabled:!a.endDateEnabled,"data-testid":"input-end-date"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Service Type"}),e.jsxs(N,{value:a.serviceType,onValueChange:me,children:[e.jsx(k,{className:"mt-2 bg-white border-gray-200 rounded-md w-full","data-testid":"select-service-type",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"New Vehicle Purchase",children:"New Vehicle Purchase"}),e.jsx(n,{value:"Service Visit",children:"Service Visit"}),e.jsx(n,{value:"Parts Purchase",children:"Parts Purchase"}),e.jsx(n,{value:"Financing",children:"Financing"}),e.jsx(n,{value:"Leasing",children:"Leasing"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Trigger Source"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Select how campaigns will be triggered"}),e.jsxs(Q,{value:a.triggerSourceType,onValueChange:s=>l("triggerSourceType",s),className:"space-y-3",children:[e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.triggerSourceType==="leadspark"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("triggerSourceType","leadspark"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(T,{value:"leadspark",id:"trigger-leadspark",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-primary"}),e.jsx(r,{htmlFor:"trigger-leadspark",className:"font-medium text-gray-900 cursor-pointer",children:"Leadspark"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Campaigns will be triggered automatically from Leadspark events"})]})]})}),e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.triggerSourceType==="external_webhook"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("triggerSourceType","external_webhook"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(T,{value:"external_webhook",id:"trigger-external",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),e.jsx(r,{htmlFor:"trigger-external",className:"font-medium text-gray-900 cursor-pointer",children:"External System (Webhook)"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Campaigns will be triggered via webhook from an external system"})]})]})})]}),a.triggerSourceType==="external_webhook"&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx(r,{htmlFor:"trigger-webhook-url",className:"text-sm font-medium text-gray-900",children:"Webhook Endpoint URL"}),e.jsx(y,{id:"trigger-webhook-url",value:a.triggerSourceWebhookUrl,onChange:s=>l("triggerSourceWebhookUrl",s.target.value),placeholder:"https://api.external-system.com/trigger",className:"mt-2 bg-white border-gray-200","data-testid":"input-trigger-webhook-url"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"The external system will send trigger events to this webhook"})]})]})]});case 2:return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-base font-semibold text-gray-900",children:"Timeline Flow"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Define the sequence of actions for campaign timeline"})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:pe,className:"border-gray-200","data-testid":"button-add-step",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Add Step"]})]}),e.jsx(B,{items:a.followUpSteps,onReorder:s=>l("followUpSteps",s.map((d,x)=>({...d,order:x+1}))),renderItem:(s,d)=>{const x=ce.has(s.id),u=()=>{if(!x)return null;switch(s.actionType){case"Send Email":const h=p(s.id,"emailTemplateSource")||"manual";return e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{className:"text-sm font-semibold text-gray-900 mb-2 block",children:"Email Template"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:'Configure the email template source for "Send Email" steps'}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-primary"}),e.jsx(r,{className:"text-sm text-gray-900",children:"From Leadspark"})]}),e.jsx(g,{checked:h==="leadspark",onCheckedChange:t=>m(s.id,{emailTemplateSource:t?"leadspark":"manual",emailSelectedSurvey:t?R[0].id:""}),disabled:h==="fidspark","data-testid":"switch-email-leadspark"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),e.jsx(r,{className:"text-sm text-gray-900",children:"From Fidspark"})]}),e.jsx(g,{checked:h==="fidspark",onCheckedChange:t=>m(s.id,{emailTemplateSource:t?"fidspark":"manual",emailSelectedSurvey:t?F[0].id:""}),disabled:h==="leadspark","data-testid":"switch-email-fidspark"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-primary"}),e.jsx(r,{className:"text-sm text-gray-900",children:"Manual"})]}),e.jsx(g,{checked:h==="manual",onCheckedChange:t=>m(s.id,{emailTemplateSource:t?"manual":"leadspark",emailSelectedSurvey:""}),disabled:h==="leadspark"||h==="fidspark","data-testid":"switch-email-manual"})]})]}),h==="leadspark"&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 block",children:"Select Leadspark Survey"}),e.jsxs(N,{value:p(s.id,"emailSelectedSurvey")||R[0].id,onValueChange:t=>m(s.id,{emailSelectedSurvey:t}),children:[e.jsx(k,{className:"bg-white border-gray-200","data-testid":"select-email-leadspark-survey",children:e.jsx(w,{placeholder:"Select a survey template"})}),e.jsx(S,{children:R.map(t=>e.jsx(n,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.description})]})},t.id))})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Email content will be pulled from Leadspark survey template"})]}),h==="fidspark"&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 block",children:"Select Fidspark Survey"}),e.jsxs(N,{value:p(s.id,"emailSelectedSurvey")||F[0].id,onValueChange:t=>m(s.id,{emailSelectedSurvey:t}),children:[e.jsx(k,{className:"bg-white border-gray-200","data-testid":"select-email-fidspark-survey",children:e.jsx(w,{placeholder:"Select a survey template"})}),e.jsx(S,{children:F.map(t=>e.jsx(n,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.description})]})},t.id))})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"Email content will be pulled from Fidspark survey template"})]}),h==="manual"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Subject"}),e.jsx(y,{value:p(s.id,"emailSubject")||a.messageTemplates.email.subject,onChange:t=>m(s.id,{emailSubject:t.target.value}),placeholder:"We'd love your feedback!",className:"mt-2 bg-white border-gray-200","data-testid":"input-email-subject"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Body"}),e.jsx(A,{value:p(s.id,"emailBody")||a.messageTemplates.email.body,onChange:t=>m(s.id,{emailBody:t.target.value}),placeholder:"Use {{customerName}} and {{surveyLink}} as placeholders",className:"mt-2 bg-white border-gray-200",rows:4,"data-testid":"input-email-body"})]})]})]});case"Send SMS":const b=p(s.id,"smsTemplateSource")||"manual";return e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{className:"text-sm font-semibold text-gray-900 mb-2 block",children:"SMS Template"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:'Configure the SMS template source for "Send SMS" steps'}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-primary"}),e.jsx(r,{className:"text-sm text-gray-900",children:"From Leadspark"})]}),e.jsx(g,{checked:b==="leadspark",onCheckedChange:t=>m(s.id,{smsTemplateSource:t?"leadspark":"manual",smsSelectedSurvey:t?R[0].id:""}),disabled:b==="fidspark","data-testid":"switch-sms-leadspark"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),e.jsx(r,{className:"text-sm text-gray-900",children:"From Fidspark"})]}),e.jsx(g,{checked:b==="fidspark",onCheckedChange:t=>m(s.id,{smsTemplateSource:t?"fidspark":"manual",smsSelectedSurvey:t?F[0].id:""}),disabled:b==="leadspark","data-testid":"switch-sms-fidspark"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-primary"}),e.jsx(r,{className:"text-sm text-gray-900",children:"Manual"})]}),e.jsx(g,{checked:b==="manual",onCheckedChange:t=>m(s.id,{smsTemplateSource:t?"manual":"leadspark",smsSelectedSurvey:""}),disabled:b==="leadspark"||b==="fidspark","data-testid":"switch-sms-manual"})]})]}),b==="leadspark"&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 block",children:"Select Leadspark Survey"}),e.jsxs(N,{value:p(s.id,"smsSelectedSurvey")||R[0].id,onValueChange:t=>m(s.id,{smsSelectedSurvey:t}),children:[e.jsx(k,{className:"bg-white border-gray-200","data-testid":"select-sms-leadspark-survey",children:e.jsx(w,{placeholder:"Select a survey template"})}),e.jsx(S,{children:R.map(t=>e.jsx(n,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.description})]})},t.id))})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"SMS content will be pulled from Leadspark survey template"})]}),b==="fidspark"&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 block",children:"Select Fidspark Survey"}),e.jsxs(N,{value:p(s.id,"smsSelectedSurvey")||F[0].id,onValueChange:t=>m(s.id,{smsSelectedSurvey:t}),children:[e.jsx(k,{className:"bg-white border-gray-200","data-testid":"select-sms-fidspark-survey",children:e.jsx(w,{placeholder:"Select a survey template"})}),e.jsx(S,{children:F.map(t=>e.jsx(n,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.description})]})},t.id))})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"SMS content will be pulled from Fidspark survey template"})]}),b==="manual"&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Message"}),e.jsx(A,{value:p(s.id,"smsBody")||a.messageTemplates.sms.body,onChange:t=>m(s.id,{smsBody:t.target.value}),placeholder:"Hi {{customerName}}! Rate your experience: {{surveyLink}}",className:"mt-2 bg-white border-gray-200",rows:3,"data-testid":"input-sms-body"})]})]});case"Send AI Call":return e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{className:"text-sm font-semibold text-gray-900 mb-2 block",children:"AI Agent Settings"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:'Configure the AI agent for "Send AI Call" steps'}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Start After (hours)"}),e.jsx(y,{type:"number",value:p(s.id,"startAfterHours")??a.aiAgentSettings.startAfterHours,onChange:t=>m(s.id,{startAfterHours:parseInt(t.target.value)||0}),className:"mt-2 bg-white border-gray-200","data-testid":"input-start-after"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours to wait before making the first call"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Retry Interval (hours)"}),e.jsx(y,{type:"number",value:p(s.id,"retryIntervalHours")??a.aiAgentSettings.retryIntervalHours,onChange:t=>m(s.id,{retryIntervalHours:parseInt(t.target.value)||0}),className:"mt-2 bg-white border-gray-200","data-testid":"input-retry-interval"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours between retry attempts"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Max Retries"}),e.jsx(y,{type:"number",value:p(s.id,"maxRetries")??a.aiAgentSettings.maxRetries,onChange:t=>m(s.id,{maxRetries:parseInt(t.target.value)||0}),className:"mt-2 bg-white border-gray-200","data-testid":"input-max-retries"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Voice Type"}),e.jsxs(N,{value:p(s.id,"voiceType")||a.aiAgentSettings.voiceType,onValueChange:t=>m(s.id,{voiceType:t}),children:[e.jsx(k,{className:"mt-2 bg-white border-gray-200","data-testid":"select-voice-type",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"Male 1",children:"Male 1"}),e.jsx(n,{value:"Male 2",children:"Male 2"}),e.jsx(n,{value:"Female 1",children:"Female 1"}),e.jsx(n,{value:"Female 2",children:"Female 2"}),e.jsx(n,{value:"Neutral",children:"Neutral"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Call Window From"}),e.jsx(y,{type:"time",value:p(s.id,"callWindowFrom")||a.aiAgentSettings.callWindowFrom,onChange:t=>m(s.id,{callWindowFrom:t.target.value}),className:"mt-2 bg-white border-gray-200","data-testid":"input-call-from"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Call Window To"}),e.jsx(y,{type:"time",value:p(s.id,"callWindowTo")||a.aiAgentSettings.callWindowTo,onChange:t=>m(s.id,{callWindowTo:t.target.value}),className:"mt-2 bg-white border-gray-200","data-testid":"input-call-to"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Persona Script"}),e.jsx(A,{value:p(s.id,"personaScript")||a.aiAgentSettings.personaScript,onChange:t=>m(s.id,{personaScript:t.target.value}),className:"mt-2 bg-white border-gray-200",rows:4,placeholder:"Hello, this is Sarah from AutoHaus. I'm calling to follow up on your recent experience with us...","data-testid":"input-persona-script"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The script the AI agent will use when making calls"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{className:"text-sm font-semibold text-gray-900 mb-3 block",children:"Human Escalation Triggers"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm text-gray-900",children:"On Call Failure"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Escalate when AI agent cannot complete the call"})]}),e.jsx(g,{checked:p(s.id,"triggerHumanFollowUpOnFailure")??a.aiAgentSettings.triggerHumanFollowUpOnFailure,onCheckedChange:t=>m(s.id,{triggerHumanFollowUpOnFailure:t}),"data-testid":"switch-escalate-failure"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm text-gray-900",children:"On Dissatisfaction Detected"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Escalate when customer expresses dissatisfaction"})]}),e.jsx(g,{checked:p(s.id,"triggerHumanFollowUpOnDissatisfaction")??a.aiAgentSettings.triggerHumanFollowUpOnDissatisfaction,onCheckedChange:t=>m(s.id,{triggerHumanFollowUpOnDissatisfaction:t}),"data-testid":"switch-escalate-dissatisfaction"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm text-gray-900",children:"On Verbal Complaint"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Escalate when customer makes a verbal complaint"})]}),e.jsx(g,{checked:p(s.id,"triggerHumanFollowUpOnVerbalComplaint")??a.aiAgentSettings.triggerHumanFollowUpOnVerbalComplaint,onCheckedChange:t=>m(s.id,{triggerHumanFollowUpOnVerbalComplaint:t}),"data-testid":"switch-escalate-complaint"})]})]})]})]})]});default:return null}};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsxs("span",{className:"text-sm text-gray-400 font-medium",children:["#",d+1]}),e.jsxs(N,{value:s.actionType,onValueChange:h=>{const b=a.followUpSteps.map(t=>t.id===s.id?{...t,actionType:h}:t);l("followUpSteps",b)},children:[e.jsx(k,{className:"flex-1 bg-white border-gray-200",children:e.jsx(w,{})}),e.jsx(S,{children:Me.map(h=>e.jsx(n,{value:h,children:h},h))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"text-xs text-gray-500 whitespace-nowrap",children:"Delay"}),e.jsx(y,{type:"number",value:s.delayDays,onChange:h=>{const b=a.followUpSteps.map(t=>t.id===s.id?{...t,delayDays:parseInt(h.target.value)||0}:t);l("followUpSteps",b)},className:"w-16 bg-white border-gray-200",min:0})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>ge(s.id),className:"text-gray-400 hover:text-red-600",disabled:a.followUpSteps.length===1,children:e.jsx(G,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"border-t border-gray-100",children:[e.jsxs("button",{type:"button",onClick:()=>ye(s.id),className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-gray-900 hover:bg-gray-50 transition-colors",children:[e.jsx("span",{children:"Settings"}),x?e.jsx(Ae,{className:"h-4 w-4 text-gray-500"}):e.jsx(Fe,{className:"h-4 w-4 text-gray-500"})]}),x&&e.jsx("div",{className:"px-4 pb-4",children:u()})]})]})}})]})});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-base font-semibold text-gray-900",children:"Connect Leads Source"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Select how you want to import leads for this campaign"}),e.jsxs(Q,{value:a.dataSourceType,onValueChange:s=>l("dataSourceType",s),className:"space-y-3",children:[e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.dataSourceType==="external_crm"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("dataSourceType","external_crm"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(T,{value:"external_crm",id:"external_crm",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),e.jsx(r,{htmlFor:"external_crm",className:"font-medium text-gray-900 cursor-pointer",children:"External CRM"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Connect to an external CRM system via API"})]})]})}),e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.dataSourceType==="leadspark"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("dataSourceType","leadspark"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(T,{value:"leadspark",id:"leadspark",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-primary"}),e.jsx(r,{htmlFor:"leadspark",className:"font-medium text-gray-900 cursor-pointer",children:"Leadspark Internal"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use leads from your Leadspark internal system"})]})]})}),e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.dataSourceType==="manual_upload"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("dataSourceType","manual_upload"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(T,{value:"manual_upload",id:"manual_upload",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-primary"}),e.jsx(r,{htmlFor:"manual_upload",className:"font-medium text-gray-900 cursor-pointer",children:"Manual Upload"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Upload a CSV file or enter leads manually"})]})]})})]})]}),a.dataSourceType==="external_crm"&&e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{htmlFor:"crm-url",className:"text-sm font-medium text-gray-900",children:"External CRM API URL *"}),e.jsx(y,{id:"crm-url",value:a.externalCrmUrl,onChange:s=>l("externalCrmUrl",s.target.value),placeholder:"https://api.yourcrm.com/leads",className:"mt-2 bg-white border-gray-200","data-testid":"input-external-crm-url"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Enter the API endpoint URL to fetch leads from your CRM"})]}),a.dataSourceType==="leadspark"&&e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Leadspark Connection"}),e.jsxs(j,{className:"p-4 mt-2 bg-green-50 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Connected to Leadspark"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Leads will be automatically synced from your Leadspark account"})]})]}),a.dataSourceType==="manual_upload"&&e.jsxs("div",{className:"pt-4 border-t border-gray-100 space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"target",className:"text-sm font-medium text-gray-900",children:"Target Audience Description *"}),e.jsx(A,{id:"target",value:a.targetAudience,onChange:s=>l("targetAudience",s.target.value),placeholder:"Describe who will receive this survey",className:"mt-2 bg-white border-gray-200",rows:2,"data-testid":"input-target-audience"})]}),e.jsx(j,{className:"p-6 border-dashed border-2 border-gray-200 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-4 text-center",children:[e.jsx(Y,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Drop your CSV file here"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"or click to browse"}),e.jsx(v,{variant:"outline",size:"sm",className:"mt-3 border-gray-200",children:"Select File"})]})})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Trigger Type"}),e.jsxs(N,{value:a.triggerType,onValueChange:s=>l("triggerType",s),children:[e.jsx(k,{className:"mt-2 bg-white border-gray-200","data-testid":"select-trigger-type",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"Immediate",children:"Immediate"}),e.jsx(n,{value:"Delayed",children:"Delayed"})]})]}),a.triggerType==="Delayed"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(r,{htmlFor:"delay",className:"text-sm font-medium text-gray-900",children:"Delay Hours"}),e.jsx(y,{id:"delay",type:"number",value:a.delayHours,onChange:s=>l("delayHours",parseInt(s.target.value)||0),className:"mt-2 bg-white border-gray-200","data-testid":"input-delay-hours"})]})]})]});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-base font-semibold text-gray-900",children:"Question Source"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Choose how to configure survey questions"}),e.jsxs(Q,{value:a.questionSourceType,onValueChange:s=>{l("questionSourceType",s),s==="leadspark"?l("selectedSurveyId",R[0].id):s==="fidspark"&&l("selectedSurveyId",F[0].id)},className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.questionSourceType==="leadspark"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>{l("questionSourceType","leadspark"),l("selectedSurveyId",R[0].id)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{value:"leadspark",id:"survey-leadspark"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"survey-leadspark",className:"font-medium text-gray-900 cursor-pointer",children:"Leadspark"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use Leadspark survey templates"})]})]})]})}),e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.questionSourceType==="fidspark"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>{l("questionSourceType","fidspark"),l("selectedSurveyId",F[0].id)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{value:"fidspark",id:"survey-fidspark"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"survey-fidspark",className:"font-medium text-gray-900 cursor-pointer",children:"Fidspark"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use Fidspark survey templates"})]})]})]})}),e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.questionSourceType==="external"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("questionSourceType","external"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{value:"external",id:"survey-external"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"survey-external",className:"font-medium text-gray-900 cursor-pointer",children:"External API"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Connect to external API"})]})]})]})}),e.jsx(j,{className:`p-4 bg-white border rounded-lg cursor-pointer transition-all ${a.questionSourceType==="manual"?"border-primary ring-1 ring-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l("questionSourceType","manual"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{value:"manual",id:"survey-manual"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"survey-manual",className:"font-medium text-gray-900 cursor-pointer",children:"Manual"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add and customize questions"})]})]})]})})]})]}),a.questionSourceType==="leadspark"&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 block",children:"Select Leadspark Survey"}),e.jsxs(N,{value:a.selectedSurveyId,onValueChange:s=>l("selectedSurveyId",s),children:[e.jsx(k,{className:"bg-white border-gray-200","data-testid":"select-leadspark-survey",children:e.jsx(w,{placeholder:"Select a survey template"})}),e.jsx(S,{children:R.map(s=>e.jsx(n,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:s.description})]})},s.id))})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Survey questions will be pulled from the selected Leadspark template"})]}),a.questionSourceType==="fidspark"&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 block",children:"Select Fidspark Survey"}),e.jsxs(N,{value:a.selectedSurveyId,onValueChange:s=>l("selectedSurveyId",s),children:[e.jsx(k,{className:"bg-white border-gray-200","data-testid":"select-fidspark-survey",children:e.jsx(w,{placeholder:"Select a survey template"})}),e.jsx(S,{children:F.map(s=>e.jsx(n,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:s.description})]})},s.id))})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"Survey questions will be pulled from the selected Fidspark template"})]}),a.questionSourceType==="external"&&e.jsxs("div",{className:"pt-4",children:[e.jsx(r,{htmlFor:"question-source-url",className:"text-sm font-medium text-gray-900",children:"External Question Source URL *"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(y,{id:"question-source-url",value:a.externalQuestionSourceUrl,onChange:s=>l("externalQuestionSourceUrl",s.target.value),placeholder:"https://api.example.com/survey-questions",className:"bg-white border-gray-200 flex-1","data-testid":"input-external-question-url"}),e.jsxs(v,{variant:"outline",className:"border-gray-200",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Connect"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Questions will be fetched from this endpoint"})]}),a.questionSourceType==="manual"&&e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",children:"Survey Questions"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:ue,className:"border-gray-200","data-testid":"button-add-question",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Add Question"]})]}),e.jsx(B,{items:a.surveyQuestions,onReorder:s=>l("surveyQuestions",s),renderItem:s=>e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsxs(N,{value:s.type,onValueChange:d=>{const x=a.surveyQuestions.map(u=>u.id===s.id?{...u,type:d}:u);l("surveyQuestions",x)},children:[e.jsx(k,{className:"w-28 bg-white border-gray-200",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"Rating",children:"Rating"}),e.jsx(n,{value:"Yes/No",children:"Yes/No"}),e.jsx(n,{value:"Text",children:"Text"}),e.jsx(n,{value:"Grade",children:"Grade"})]})]}),e.jsx(y,{value:s.text,onChange:d=>{const x=a.surveyQuestions.map(u=>u.id===s.id?{...u,text:d.target.value}:u);l("surveyQuestions",x)},placeholder:"Question text",className:"flex-1 bg-white border-gray-200"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Required"}),e.jsx(g,{checked:s.required,onCheckedChange:d=>{const x=a.surveyQuestions.map(u=>u.id===s.id?{...u,required:d}:u);l("surveyQuestions",x)}})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>he(s.id),className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-4 w-4"})})]})})]})]});case 5:return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(r,{className:"text-base font-semibold text-gray-900",children:"Outcome Rules"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Configure actions based on NPS response categories"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(j,{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-600 mb-1",children:"Detractors (0-6)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Actions for customers who gave low scores"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Create Fidspark Dispute"}),e.jsx(g,{checked:a.outcomeRules.detractors.createFidsparkDispute,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,createFidsparkDispute:s}}),"data-testid":"switch-fidspark"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Create Leadspark Task"}),e.jsx(g,{checked:a.outcomeRules.detractors.createLeadsparkTask,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,createLeadsparkTask:s}}),"data-testid":"switch-leadspark"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Create Webhook Task"}),e.jsx(g,{checked:a.outcomeRules.detractors.createWebhookTask,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,createWebhookTask:s}}),"data-testid":"switch-webhook"})]})]})]}),e.jsxs(j,{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-600 mb-1",children:"Non Responders"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Actions for customers who did not respond to the survey"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Create Fidspark Dispute"}),e.jsx(g,{checked:a.outcomeRules.nonResponders.createFidsparkDispute,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,nonResponders:{...a.outcomeRules.nonResponders,createFidsparkDispute:s}}),"data-testid":"switch-nonresponders-fidspark"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Create Leadspark Task"}),e.jsx(g,{checked:a.outcomeRules.nonResponders.createLeadsparkTask,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,nonResponders:{...a.outcomeRules.nonResponders,createLeadsparkTask:s}}),"data-testid":"switch-nonresponders-leadspark"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Create Webhook Task"}),e.jsx(g,{checked:a.outcomeRules.nonResponders.createWebhookTask,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,nonResponders:{...a.outcomeRules.nonResponders,createWebhookTask:s}}),"data-testid":"switch-nonresponders-webhook"})]})]})]}),e.jsxs(j,{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-600 mb-1",children:"Promoters (9-10)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Actions for satisfied customers"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-sm text-gray-900",children:"Notify Fidspark"}),e.jsx(g,{checked:a.outcomeRules.promoters.notifyFidspark,onCheckedChange:s=>l("outcomeRules",{...a.outcomeRules,promoters:{notifyFidspark:s}}),"data-testid":"switch-notify-fidspark"})]})]}),e.jsxs(j,{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-amber-600 mb-1",children:"Passives (7-8)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No automatic action configured for passive responses"})]}),e.jsxs(j,{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"External System Notification"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Broadcast campaign results to external systems for integration and syncing"})]}),e.jsx(g,{checked:a.outcomeRules.detractors.createWebhookTask,onCheckedChange:s=>{l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,createWebhookTask:s}})},"data-testid":"switch-external-notification"})]}),a.outcomeRules.detractors.createWebhookTask&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhook-url",className:"text-sm font-medium text-gray-900",children:"Webhook URL *"}),e.jsx(y,{id:"webhook-url",placeholder:"https://api.external-system.com/campaigns/sync",value:a.outcomeRules.detractors.webhookUrl,onChange:s=>l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,webhookUrl:s.target.value}}),className:"mt-2 bg-white border-gray-200 text-sm","data-testid":"input-webhook-url"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The endpoint to receive campaign result notifications"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhook-secret",className:"text-sm font-medium text-gray-900",children:"Secret Key"}),e.jsx(y,{id:"webhook-secret",placeholder:"sk_live_...",type:"password",value:a.outcomeRules.detractors.webhookSecret,onChange:s=>l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,webhookSecret:s.target.value}}),className:"mt-2 bg-white border-gray-200 text-sm","data-testid":"input-webhook-secret"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Used to sign and verify webhook authenticity"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhook-payload",className:"text-sm font-medium text-gray-900",children:"Payload Template"}),e.jsx(A,{id:"webhook-payload",placeholder:'{"campaignId": "{{campaignId}}", "npsScore": "{{npsScore}}", "responseCount": "{{responseCount}}", "timestamp": "{{timestamp}}"}',value:a.outcomeRules.detractors.webhookPayloadTemplate,onChange:s=>l("outcomeRules",{...a.outcomeRules,detractors:{...a.outcomeRules.detractors,webhookPayloadTemplate:s.target.value}}),className:"mt-2 bg-white border-gray-200 text-sm",rows:4,"data-testid":"input-webhook-payload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JSON template with dynamic fields: campaignId, npsScore, responseCount, timestamp, promotersPercent, detractorsPercent, passivesPercent"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-900 mb-2 flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),"Trigger Events"]})}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Automatically send notifications on these events"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"trigger-completion",defaultChecked:!0,className:"rounded border-gray-300"}),e.jsx(r,{htmlFor:"trigger-completion",className:"text-xs text-gray-700 cursor-pointer",children:"On campaign completion"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"trigger-daily",defaultChecked:!0,className:"rounded border-gray-300"}),e.jsx(r,{htmlFor:"trigger-daily",className:"text-xs text-gray-700 cursor-pointer",children:"Daily summary updates"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"trigger-threshold",className:"rounded border-gray-300"}),e.jsx(r,{htmlFor:"trigger-threshold",className:"text-xs text-gray-700 cursor-pointer",children:"When NPS threshold changes"})]})]})]})]})]})]})]})});default:return null}};return e.jsxs("div",{className:"min-h-full bg-gray-50",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>o("/campaigns"),"data-testid":"button-back",className:"h-9 w-9 text-gray-500 hover:text-gray-900 hover:bg-gray-100",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-testid":"text-page-title",children:"Create Campaign"})]}),e.jsxs("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-semibold whitespace-nowrap",children:["Step ",i,"/",K.length]})]}),e.jsx("div",{className:"mb-8 -mx-8 px-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Pe,{steps:K,currentStep:i,onStepClick:s=>{s<i&&f(s)}})})}),e.jsx(j,{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:ve()}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(v,{variant:"outline",onClick:be,disabled:i===1,className:"border-gray-200","data-testid":"button-previous",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Previous"]}),i<5?e.jsxs(v,{onClick:je,className:"bg-primary hover:bg-primary/90 text-white","data-testid":"button-next",children:["Next",e.jsx(Ie,{className:"h-4 w-4 ml-2"})]}):e.jsxs(v,{onClick:fe,className:"bg-primary hover:bg-primary/90 text-white","data-testid":"button-launch",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Launch Campaign"]})]})]}),e.jsx(Ve,{open:M,onOpenChange:D,children:e.jsxs(re,{className:"bg-white",children:[e.jsxs(le,{children:[e.jsx(de,{className:"text-gray-900",children:"Change Service Type?"}),e.jsx(ne,{className:"text-gray-500",children:"Changing the service type will replace your current survey questions with default questions for the new service type. This action cannot be undone."})]}),e.jsxs(ie,{children:[e.jsx(v,{variant:"outline",onClick:()=>D(!1),className:"border-gray-200",children:"Cancel"}),e.jsx(v,{onClick:xe,className:"bg-primary hover:bg-primary/90 text-white",children:"Change Service Type"})]})]})})]})}export{Ye as default};
