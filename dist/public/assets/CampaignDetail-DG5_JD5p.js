import{d as Pe,j as e,L as ne,e as oe,f as de,g as Ie,O as ce,h as me,i as De,k as xe,l as ue,m as Fe,n as Ee,o as Le,H as He,p as he,q as ge}from"./vendor-radix-C_vsl6Su.js";import{r as g}from"./vendor-react--0RGCJ5T.js";import{c as y,a as v,C as pe,X as ze,b as Be,I as j,S as Oe,d as $e,u as Ue,e as Qe,f as re,U as We}from"./index-DyA_X1RM.js";import{B as w,P as Ve,u as qe,v as _e,b as Ke}from"./campaignStore-1WzPW7VV.js";import{C as R}from"./card-ZJBVhEJN.js";import{B as k,S as Ye}from"./StatusBadge-C4eOHC0O.js";import{R as be,P as Ge,a as Xe,C as Je,T as je,L as Ze,b as et,c as tt,X as st,Y as at,d as rt}from"./vendor-charts-DbA9NZ_1.js";import{C as it,L as m,T as P,S as V,a as q,b as _,c as K,d as f,e as lt,D as ie,f as N,g as nt,A as ot}from"./DraggableList-BNOEdPZZ.js";import{f as L,a as dt,i as ct}from"./vendor-utils-DlWX2jwD.js";import{C as ye}from"./circle-alert-wgjKoCMp.js";import"./vendor-dnd-CP4G9cd3.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=y("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=y("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=y("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=y("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=y("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=y("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=y("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=y("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=y("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=y("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=y("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=y("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=y("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=y("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ce=Pe,Z=g.forwardRef(({className:n,...a},r)=>e.jsx(ne,{ref:r,className:v("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...a}));Z.displayName=ne.displayName;const T=g.forwardRef(({className:n,...a},r)=>e.jsx(oe,{ref:r,className:v("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...a}));T.displayName=oe.displayName;const M=g.forwardRef(({className:n,...a},r)=>e.jsx(de,{ref:r,className:v("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...a}));M.displayName=de.displayName;function jt({promotersPercent:n,passivesPercent:a,detractorsPercent:r,npsScore:x}){const p=[{name:"Promoters (9-10)",value:n,color:"#4CAF50"},{name:"Passives (7-8)",value:a,color:"#F59E0B"},{name:"Detractors (0-6)",value:r,color:"rgb(249, 0, 50)"}];return e.jsxs("div",{className:"relative w-full h-[280px]","data-testid":"chart-nps-donut",children:[e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Ge,{children:[e.jsx(Xe,{data:p,cx:"50%",cy:"45%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",children:p.map((l,u)=>e.jsx(Je,{fill:l.color},`cell-${u}`))}),e.jsx(je,{formatter:l=>[`${l}%`,""],contentStyle:{backgroundColor:"#fff",border:"1px solid #E5E7EB",borderRadius:"8px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1)"}}),e.jsx(Ze,{verticalAlign:"bottom",height:36,formatter:l=>e.jsx("span",{className:"text-xs text-gray-600",children:l})})]})}),e.jsxs("div",{className:"absolute top-[35%] left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center",children:[e.jsx("span",{className:"text-5xl font-bold",style:{color:"#E64A19"},"data-testid":"text-nps-center",children:x}),e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider mt-1 font-medium",children:"NPS Score"})]})]})}function I({label:n,value:a,color:r,count:x}){return e.jsxs("div",{className:"space-y-2","data-testid":`bar-distribution-${n.toLowerCase().replace(/[^a-z0-9]/g,"-")}`,children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n}),e.jsxs("span",{className:"text-gray-500",children:[a,"%",x!==void 0&&` (${x})`]})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${a}%`,backgroundColor:r}})})]})}function Y({title:n,icon:a,children:r,collapsible:x=!1,defaultExpanded:p=!0}){const[t,l]=g.useState(p);return e.jsxs(R,{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden","data-testid":`card-insights-${n.toLowerCase().replace(/\s+/g,"-")}`,children:[e.jsxs("div",{className:`
          flex items-center justify-between p-6 border-b border-gray-100
          ${x?"cursor-pointer hover:bg-gray-50 transition-colors":""}
        `,onClick:()=>x&&l(!t),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsx("span",{className:"text-primary",children:a}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n})]}),x&&e.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 transition-colors","data-testid":`button-toggle-${n.toLowerCase().replace(/\s+/g,"-")}`,children:t?e.jsx(it,{className:"h-5 w-5"}):e.jsx(pe,{className:"h-5 w-5"})})]}),(!x||t)&&e.jsx("div",{className:"p-6",children:r})]})}function yt({data:n}){if(n.length===0)return e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No trend data available yet"});const a=n.map(r=>({date:L(new Date(r.date),"MMM d"),score:r.score}));return e.jsx("div",{className:"w-full h-[200px]","data-testid":"chart-nps-trend",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(et,{data:a,margin:{top:5,right:20,left:0,bottom:5},children:[e.jsx(tt,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(st,{dataKey:"date",tick:{fontSize:12,fill:"hsl(var(--muted-foreground))"},axisLine:{stroke:"hsl(var(--border))"}}),e.jsx(at,{domain:[0,100],tick:{fontSize:12,fill:"hsl(var(--muted-foreground))"},axisLine:{stroke:"hsl(var(--border))"}}),e.jsx(je,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(rt,{type:"monotone",dataKey:"score",stroke:"#2563eb",strokeWidth:2,dot:{fill:"#2563eb",strokeWidth:2},activeDot:{r:6}})]})})})}const ft={Open:{className:"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-400"},"In Progress":{className:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400"},Resolved:{className:"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-400"}};function vt({tickets:n}){return n.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No detractor cases recorded"}):e.jsx("div",{className:"overflow-x-auto","data-testid":"table-detractor-cases",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Customer"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Issue"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Status"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Action Taken"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Date"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{className:"border-b border-border last:border-0","data-testid":`row-ticket-${a.id}`,children:[e.jsx("td",{className:"py-3 px-2 font-medium",children:a.customerName}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground max-w-[200px] truncate",children:a.issue}),e.jsx("td",{className:"py-3 px-2",children:e.jsx(k,{className:ft[a.status].className,variant:"outline",children:a.status})}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground max-w-[200px] truncate",children:a.actionTaken}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground whitespace-nowrap",children:L(new Date(a.createdAt),"MMM d, yyyy")})]},a.id))})]})})}const Nt=Ie,wt=Fe,Se=g.forwardRef(({className:n,...a},r)=>e.jsx(ce,{className:v("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a,ref:r}));Se.displayName=ce.displayName;const Ct=dt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ke=g.forwardRef(({side:n="right",className:a,children:r,...x},p)=>e.jsxs(wt,{children:[e.jsx(Se,{}),e.jsxs(me,{ref:p,className:v(Ct({side:n}),a),...x,children:[r,e.jsxs(De,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ke.displayName=me.displayName;const Ae=({className:n,...a})=>e.jsx("div",{className:v("flex flex-col space-y-2 text-center sm:text-left",n),...a});Ae.displayName="SheetHeader";const Re=g.forwardRef(({className:n,...a},r)=>e.jsx(xe,{ref:r,className:v("text-lg font-semibold text-foreground",n),...a}));Re.displayName=xe.displayName;const St=g.forwardRef(({className:n,...a},r)=>e.jsx(ue,{ref:r,className:v("text-sm text-muted-foreground",n),...a}));St.displayName=ue.displayName;const G=Ee,D=g.forwardRef(({className:n,...a},r)=>e.jsx(Le,{ref:r,className:v("border-b",n),...a}));D.displayName="AccordionItem";const F=g.forwardRef(({className:n,children:a,...r},x)=>e.jsx(He,{className:"flex",children:e.jsxs(he,{ref:x,className:v("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...r,children:[a,e.jsx(pe,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));F.displayName=he.displayName;const E=g.forwardRef(({className:n,children:a,...r},x)=>e.jsx(ge,{ref:x,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:e.jsx("div",{className:v("pb-4 pt-0",n),children:a})}));E.displayName=ge.displayName;function kt({campaign:n,open:a,onOpenChange:r,onSave:x}){const{toast:p}=Be(),[t,l]=g.useState(n),[u,C]=g.useState("basics"),[S,O]=g.useState(["basic-info","survey-questions"]),[$,U]=g.useState(["outcome-rules"]);g.useEffect(()=>{l(n)},[n]);const Q=()=>{const s=qe(n.id,t);s&&(x(s),p({title:"Changes saved",description:"Campaign has been updated."}),r(!1))},d=(s,o)=>{l(c=>({...c,[s]:o}))},H=n.status==="Active",W=()=>{const s={id:_e(),type:"Rating",text:"",required:!0,order:t.surveyQuestions.length+1};d("surveyQuestions",[...t.surveyQuestions,s])},z=s=>{d("surveyQuestions",t.surveyQuestions.filter(o=>o.id!==s))};return e.jsx(Nt,{open:a,onOpenChange:r,children:e.jsxs(ke,{className:"w-full sm:max-w-[448px] overflow-y-auto","data-testid":"drawer-edit",children:[e.jsx(Ae,{children:e.jsx(Re,{children:"Edit Campaign"})}),e.jsxs(Ce,{value:u,onValueChange:C,className:"mt-6",children:[e.jsxs(Z,{className:"grid w-full grid-cols-3 bg-transparent p-0 h-auto gap-0",children:[e.jsx(T,{value:"basics",className:"rounded-none border-b-2 data-[state=active]:border-b-slate-900 data-[state=active]:bg-slate-900 data-[state=active]:text-white data-[state=inactive]:border-b-transparent data-[state=inactive]:bg-transparent py-2","data-testid":"tab-basics",children:"Basics"}),e.jsx(T,{value:"timeline",className:"rounded-none border-b-2 data-[state=active]:border-b-slate-900 data-[state=active]:bg-slate-900 data-[state=active]:text-white data-[state=inactive]:border-b-transparent data-[state=inactive]:bg-transparent py-2","data-testid":"tab-timeline",children:"Timeline"}),e.jsx(T,{value:"outcomes",className:"rounded-none border-b-2 data-[state=active]:border-b-slate-900 data-[state=active]:bg-slate-900 data-[state=active]:text-white data-[state=inactive]:border-b-transparent data-[state=inactive]:bg-transparent py-2","data-testid":"tab-outcomes",children:"Outcomes"})]}),e.jsx(M,{value:"basics",className:"mt-4 space-y-4",children:e.jsxs(G,{type:"single",value:S[0]||"basic-info",onValueChange:s=>O(s?[s]:[]),className:"space-y-2",children:[e.jsxs(D,{value:"basic-info",className:"border rounded-md px-4",children:[e.jsx(F,{className:"text-sm font-medium",children:"Basic Information"}),e.jsxs(E,{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:"Campaign Name"}),e.jsx(j,{id:"name",value:t.name,onChange:s=>d("name",s.target.value),className:"bg-white mt-1","data-testid":"input-name"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(P,{id:"description",value:t.description,onChange:s=>d("description",s.target.value),className:"bg-white mt-1","data-testid":"input-description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"start-date",children:["Start Date ",!H&&"*"]}),e.jsx(j,{id:"start-date",type:"date",value:t.startDate.toISOString().split("T")[0],onChange:s=>d("startDate",new Date(s.target.value)),className:"bg-white mt-1",disabled:H,"data-testid":"input-start-date"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"end-date",children:"End Date"}),e.jsx(j,{id:"end-date",type:"date",value:t.endDate.toISOString().split("T")[0],onChange:s=>d("endDate",new Date(s.target.value)),className:"bg-white mt-1","data-testid":"input-end-date"})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Trigger Type"}),e.jsxs(V,{value:t.triggerType,onValueChange:s=>d("triggerType",s),children:[e.jsx(q,{className:"bg-white mt-1","data-testid":"select-trigger-type",children:e.jsx(_,{})}),e.jsxs(K,{children:[e.jsx(f,{value:"Immediate",children:"Immediate"}),e.jsx(f,{value:"Delayed",children:"Delayed"})]})]})]}),t.triggerType==="Delayed"&&e.jsxs("div",{children:[e.jsx(m,{htmlFor:"delay",children:"Delay Hours"}),e.jsx(j,{id:"delay",type:"number",value:t.delayHours,onChange:s=>d("delayHours",parseInt(s.target.value)||0),className:"bg-white mt-1","data-testid":"input-delay-hours"})]})]})]}),e.jsxs(D,{value:"survey-questions",className:"border rounded-md px-4",children:[e.jsx(F,{className:"text-sm font-medium",children:"Survey Questions"}),e.jsxs(E,{className:"space-y-4 pt-2",children:[t.questionSourceType==="external"&&t.externalQuestionSourceUrl&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(lt,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:"External Source Connected"}),e.jsx("p",{className:"text-xs text-blue-600/80 dark:text-blue-400/80 mt-1 break-all",children:t.externalQuestionSourceUrl})]})]})}),t.questionSourceType==="manual"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Questions"}),e.jsxs(w,{variant:"outline",size:"sm",onClick:W,"data-testid":"button-add-question",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Add Question"]})]}),e.jsx(ie,{items:t.surveyQuestions,onReorder:s=>d("surveyQuestions",s),renderItem:s=>e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(j,{value:s.text,onChange:o=>{const c=t.surveyQuestions.map(h=>h.id===s.id?{...h,text:o.target.value}:h);d("surveyQuestions",c)},placeholder:"Question text",className:"flex-1 bg-white text-sm"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(V,{value:s.type,onValueChange:o=>{const c=t.surveyQuestions.map(h=>h.id===s.id?{...h,type:o}:h);d("surveyQuestions",c)},children:[e.jsx(q,{className:"w-32 bg-white text-sm",children:e.jsx(_,{})}),e.jsxs(K,{children:[e.jsx(f,{value:"Rating",children:"Rating"}),e.jsx(f,{value:"Yes/No",children:"Yes/No"}),e.jsx(f,{value:"Text",children:"Text"}),e.jsx(f,{value:"Grade",children:"Grade"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"text-xs text-muted-foreground",children:"Required"}),e.jsx(N,{checked:s.required,onCheckedChange:o=>{const c=t.surveyQuestions.map(h=>h.id===s.id?{...h,required:o}:h);d("surveyQuestions",c)}})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>z(s.id),className:"text-muted-foreground",children:e.jsx(nt,{className:"h-4 w-4"})})]})]})})]})]})]})]})}),e.jsx(M,{value:"timeline",className:"mt-4 space-y-4",children:e.jsx(G,{type:"single",defaultValue:t.followUpSteps.length===1?t.followUpSteps[0].id:void 0,className:"space-y-2",children:t.followUpSteps.map((s,o)=>{var c,h,B;return e.jsxs(D,{value:s.id,className:"border rounded-md px-4",children:[e.jsx(F,{className:"text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.actionType==="Send Email"&&e.jsx(ve,{className:"h-4 w-4"}),s.actionType==="Send SMS"&&e.jsx(Ne,{className:"h-4 w-4"}),s.actionType==="Send AI Call"&&e.jsx(J,{className:"h-4 w-4"}),e.jsxs("span",{children:["Step ",o+1,": ",s.actionType]})]})}),e.jsxs(E,{className:"space-y-4 pt-2",children:[s.actionType==="Send Email"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(m,{children:"Subject"}),e.jsx(j,{value:((c=s.configuration)==null?void 0:c.emailSubject)||"",onChange:i=>{const A=t.followUpSteps.map(b=>b.id===s.id?{...b,configuration:{...b.configuration,emailSubject:i.target.value}}:b);d("followUpSteps",A)},className:"bg-white text-sm",placeholder:"Email subject"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Body"}),e.jsx(P,{value:((h=s.configuration)==null?void 0:h.emailBody)||"",onChange:i=>{const A=t.followUpSteps.map(b=>b.id===s.id?{...b,configuration:{...b.configuration,emailBody:i.target.value}}:b);d("followUpSteps",A)},className:"bg-white text-sm",placeholder:"Email body",rows:3})]})]}),s.actionType==="Send SMS"&&e.jsxs("div",{children:[e.jsx(m,{children:"SMS Body"}),e.jsx(P,{value:((B=s.configuration)==null?void 0:B.smsBody)||"",onChange:i=>{const A=t.followUpSteps.map(b=>b.id===s.id?{...b,configuration:{...b.configuration,smsBody:i.target.value}}:b);d("followUpSteps",A)},className:"bg-white text-sm",placeholder:"SMS body",rows:2})]}),s.actionType==="Send AI Call"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"AI Agent Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Start After (hours)"}),e.jsx(j,{type:"number",value:t.aiAgentSettings.startAfterHours,onChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,startAfterHours:parseInt(i.target.value)||0}),className:"bg-white mt-1 text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Hours to wait before first call"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Retry Interval (hours)"}),e.jsx(j,{type:"number",value:t.aiAgentSettings.retryIntervalHours,onChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,retryIntervalHours:parseInt(i.target.value)||0}),className:"bg-white mt-1 text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Hours between retries"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Max Retries"}),e.jsx(j,{type:"number",value:t.aiAgentSettings.maxRetries,onChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,maxRetries:parseInt(i.target.value)||0}),className:"bg-white mt-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Voice Type"}),e.jsxs(V,{value:t.aiAgentSettings.voiceType,onValueChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,voiceType:i}),children:[e.jsx(q,{className:"bg-white mt-1 text-sm",children:e.jsx(_,{})}),e.jsxs(K,{children:[e.jsx(f,{value:"Male 1",children:"Male 1"}),e.jsx(f,{value:"Male 2",children:"Male 2"}),e.jsx(f,{value:"Female 1",children:"Female 1"}),e.jsx(f,{value:"Female 2",children:"Female 2"}),e.jsx(f,{value:"Neutral",children:"Neutral"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Call Window From"}),e.jsx(j,{type:"time",value:t.aiAgentSettings.callWindowFrom,onChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,callWindowFrom:i.target.value}),className:"bg-white mt-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Call Window To"}),e.jsx(j,{type:"time",value:t.aiAgentSettings.callWindowTo,onChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,callWindowTo:i.target.value}),className:"bg-white mt-1 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Persona Script"}),e.jsx(P,{value:t.aiAgentSettings.personaScript,onChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,personaScript:i.target.value}),className:"bg-white mt-1 text-sm",rows:3,placeholder:"Hello, this is Sarah from AutoHaus..."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"The script the AI agent will use"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx(m,{className:"text-sm font-medium mb-3 block",children:"Human Escalation Triggers"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"On Call Failure"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Escalate on failure"})]}),e.jsx(N,{checked:t.aiAgentSettings.triggerHumanFollowUpOnFailure,onCheckedChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,triggerHumanFollowUpOnFailure:i})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"On Dissatisfaction"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Customer unhappy"})]}),e.jsx(N,{checked:t.aiAgentSettings.triggerHumanFollowUpOnDissatisfaction,onCheckedChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,triggerHumanFollowUpOnDissatisfaction:i})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"On Verbal Complaint"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Complaint detected"})]}),e.jsx(N,{checked:t.aiAgentSettings.triggerHumanFollowUpOnVerbalComplaint,onCheckedChange:i=>d("aiAgentSettings",{...t.aiAgentSettings,triggerHumanFollowUpOnVerbalComplaint:i})})]})]})]})]})]})]},s.id)})})}),e.jsx(M,{value:"outcomes",className:"mt-4 space-y-4",children:e.jsx(G,{type:"single",value:$[0]||"outcome-rules",onValueChange:s=>U(s?[s]:[]),className:"space-y-2",children:e.jsxs(D,{value:"outcome-rules",className:"border rounded-md px-4",children:[e.jsx(F,{className:"text-sm font-medium",children:"Outcome Rules"}),e.jsx(E,{className:"space-y-6 pt-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-3",children:"Detractors (0-6)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm",children:"Create Fidspark Dispute"}),e.jsx(N,{checked:t.outcomeRules.detractors.createFidsparkDispute,onCheckedChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,createFidsparkDispute:s}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm",children:"Create Leadspark Task"}),e.jsx(N,{checked:t.outcomeRules.detractors.createLeadsparkTask,onCheckedChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,createLeadsparkTask:s}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm",children:"Create Webhook Task"}),e.jsx(N,{checked:t.outcomeRules.detractors.createWebhookTask,onCheckedChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,createWebhookTask:s}})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-3",children:"Promoters (9-10)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm",children:"Prompt Review Channels"}),e.jsx(N,{checked:t.outcomeRules.promoters.promptReviewChannels,onCheckedChange:s=>d("outcomeRules",{...t.outcomeRules,promoters:{promptReviewChannels:s}})})]}),t.outcomeRules.promoters.promptReviewChannels&&e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx(m,{className:"text-sm font-medium mb-3 block",children:"Review Channels"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Drag to reorder priority"}),e.jsx(ie,{items:t.reviewChannels,onReorder:s=>d("reviewChannels",s.map((o,c)=>({...o,priority:c+1}))),renderItem:s=>e.jsxs("div",{className:"flex-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:s.platform}),e.jsx(N,{checked:s.enabled,onCheckedChange:o=>{const c=t.reviewChannels.map(h=>h.id===s.id?{...h,enabled:o}:h);d("reviewChannels",c)}})]})})]})]}),e.jsxs("div",{className:"pt-6 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium",children:"External System Notification"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Broadcast results to external systems"})]}),e.jsx(N,{checked:t.outcomeRules.detractors.createWebhookTask,onCheckedChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,createWebhookTask:s}})})]}),t.outcomeRules.detractors.createWebhookTask&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"webhook-url-edit",className:"text-xs font-medium",children:"Webhook URL"}),e.jsx(j,{id:"webhook-url-edit",placeholder:"https://api.external-system.com/sync",value:t.outcomeRules.detractors.webhookUrl,onChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,webhookUrl:s.target.value}}),className:"bg-white mt-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"webhook-secret-edit",className:"text-xs font-medium",children:"Secret Key"}),e.jsx(j,{id:"webhook-secret-edit",placeholder:"sk_live_...",type:"password",value:t.outcomeRules.detractors.webhookSecret,onChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,webhookSecret:s.target.value}}),className:"bg-white mt-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"webhook-payload-edit",className:"text-xs font-medium",children:"Payload Template"}),e.jsx(P,{id:"webhook-payload-edit",placeholder:'{"campaignId": "{{campaignId}}", "npsScore": "{{npsScore}}"}',value:t.outcomeRules.detractors.webhookPayloadTemplate,onChange:s=>d("outcomeRules",{...t.outcomeRules,detractors:{...t.outcomeRules.detractors,webhookPayloadTemplate:s.target.value}}),className:"bg-white mt-1 text-sm",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Available: campaignId, npsScore, responseCount, promotersPercent, detractorsPercent, passivesPercent, timestamp"})]})]})]})]})]})})]})})})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-border",children:[e.jsx(w,{variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Cancel"}),e.jsx(w,{onClick:Q,className:"flex-1 bg-[rgb(249,0,50)] hover:bg-[rgb(220,0,45)]","data-testid":"button-save-settings",children:"Save Changes"})]})]})})}function At({campaignId:n}){const[a,r]=g.useState({waitingForInput:0,attemptingContact:0,activeCalls:0,escalatedToHuman:0,isPaused:!1});g.useEffect(()=>{r({waitingForInput:0,attemptingContact:5,activeCalls:3,escalatedToHuman:2,isPaused:!1});const l=setInterval(()=>{r(u=>({...u,activeCalls:Math.max(0,u.activeCalls+Math.floor(Math.random()*3)-1),attemptingContact:Math.max(0,u.attemptingContact+Math.floor(Math.random()*3)-1)}))},5e3);return()=>clearInterval(l)},[n]);const x=()=>{r(t=>({...t,isPaused:!t.isPaused}))},p=[{label:"Waiting for Input",count:a.waitingForInput,icon:fe,color:"text-gray-500",bgColor:"bg-gray-50",borderColor:"border-gray-200"},{label:"Attempting Contact",description:"SMS/Email sent, timer running",count:a.attemptingContact,icon:Ne,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{label:"Currently on AI Call",description:"active calls",count:a.activeCalls,icon:J,color:"text-primary",bgColor:"bg-primary/10",borderColor:"border-primary/20"},{label:"Escalated to Human",description:"Action Required",count:a.escalatedToHuman,icon:ye,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200"}];return e.jsxs(R,{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"AI Agent Live Status"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Real-time status of active AI agent operations"})]}),e.jsx(w,{onClick:x,variant:a.isPaused?"default":"outline",size:"sm",className:a.isPaused?"bg-primary hover:bg-primary/90 text-white":"border-gray-200",children:a.isPaused?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Resume All Outbound AI Calls"]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Pause All Outbound AI Calls"]})})]}),a.isPaused&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"All outbound AI calls are currently paused"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:p.map(t=>{const l=t.icon;return e.jsxs("div",{className:`p-4 rounded-lg border ${t.borderColor} ${t.bgColor} transition-all hover:shadow-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.bgColor}`,children:e.jsx(l,{className:`h-5 w-5 ${t.color}`})}),t.count>0&&e.jsx(k,{variant:"outline",className:`${t.color} ${t.borderColor} bg-white font-semibold`,children:t.count})]}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:t.label}),t.description&&e.jsx("p",{className:"text-xs text-gray-500",children:t.description}),t.count===0&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["(",t.count,")"]})]},t.label)})}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider mb-1",children:"Total Active"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.waitingForInput+a.attemptingContact+a.activeCalls+a.escalatedToHuman})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider mb-1",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:a.attemptingContact+a.activeCalls})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider mb-1",children:"Needs Attention"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.escalatedToHuman})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider mb-1",children:"Status"}),e.jsx("p",{className:"text-lg font-semibold",children:a.isPaused?e.jsx("span",{className:"text-amber-600",children:"Paused"}):e.jsx("span",{className:"text-green-600",children:"Active"})})]})]})})]})}const Rt=()=>{const n=new Date,a=[],r=[{id:"1",name:"John Smith"},{id:"2",name:"Sarah Johnson"},{id:"3",name:"Michael Brown"},{id:"4",name:"Emily Davis"},{id:"5",name:"David Wilson"}];for(let x=0;x<30;x++){const p=r[Math.floor(Math.random()*r.length)],t=Math.floor(Math.random()*7),l=Math.floor(Math.random()*24),u=new Date(n.getTime()-(t*24+l)*60*60*1e3),C=[{type:"action",status:"completed",title:"Agent sent Email",description:`Email sent to ${p.name}`},{type:"action",status:"completed",title:"Agent sent SMS",description:`SMS sent to ${p.name}`},{type:"action",status:"in-progress",title:"AI Call initiated",description:`AI Call in progress with ${p.name}`},{type:"decision",status:"completed",title:"No response detected",description:`No response from ${p.name}, proceeding to SMS`},{type:"decision",status:"completed",title:"SMS ignored",description:"SMS not responded, proceeding to AI Call"},{type:"outcome",status:"completed",title:"Customer rated",description:`${p.name} provided feedback`,metadata:{rating:Math.floor(Math.random()*10)+1}},{type:"scheduled",status:"scheduled",title:"Follow-up task: Human agent review",description:`Scheduled review for ${p.name}`}],S=C[Math.floor(Math.random()*C.length)];a.push({id:`event-${x}`,timestamp:u,type:S.type,status:S.status,title:S.title,description:S.description,contactName:p.name,contactId:p.id,metadata:S.metadata})}return a.sort((x,p)=>x.timestamp.getTime()-p.timestamp.getTime())};function Tt({campaignId:n}){const[a]=g.useState(Rt()),[r,x]=g.useState(new Set),[p,t]=g.useState(new Set),[l,u]=g.useState(new Set),[C,S]=g.useState(""),O=o=>{x(c=>{const h=new Set(c);return h.has(o)?h.delete(o):h.add(o),h})},$=o=>{t(c=>new Set(c).add(o))},U=o=>{u(c=>new Set(c).add(o))},Q=o=>{switch(o){case"action":return ve;case"decision":return ye;case"outcome":return le;case"scheduled":return fe;default:return le}},d=(o,c)=>{if(l.has(c)||p.has(c))return"bg-gray-100 border-gray-300 text-gray-600";if(r.has(c))return"bg-amber-50 border-amber-300 text-amber-700";switch(o){case"completed":return"bg-green-50 border-green-300 text-green-700";case"in-progress":return"bg-blue-50 border-blue-300 text-blue-700";case"scheduled":return"bg-gray-50 border-gray-300 text-gray-700";case"paused":return"bg-amber-50 border-amber-300 text-amber-700";default:return"bg-gray-50 border-gray-300 text-gray-700"}},H=o=>{switch(o){case"action":return"bg-blue-100 text-blue-800 border-blue-200";case"decision":return"bg-purple-100 text-purple-800 border-purple-200";case"outcome":return"bg-green-100 text-green-800 border-green-200";case"scheduled":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},W=(o,c)=>{if(l.has(c))return e.jsx(k,{className:"bg-gray-100 text-gray-700 border-gray-200 text-xs",children:"Cancelled"});if(p.has(c))return e.jsx(k,{className:"bg-gray-100 text-gray-700 border-gray-200 text-xs",children:"Skipped"});if(r.has(c))return e.jsx(k,{className:"bg-amber-100 text-amber-700 border-amber-200 text-xs",children:"Paused"});switch(o){case"completed":return null;case"in-progress":return e.jsx(k,{className:"bg-blue-100 text-blue-700 border-blue-200 text-xs animate-pulse",children:"Live"});case"scheduled":return e.jsx(k,{className:"bg-gray-100 text-gray-700 border-gray-200 text-xs",children:"Scheduled"});default:return null}},z=g.useMemo(()=>{if(!C.trim())return a;const o=C.toLowerCase();return a.filter(c=>c.contactName.toLowerCase().includes(o)||c.title.toLowerCase().includes(o)||c.description.toLowerCase().includes(o)||c.type.toLowerCase().includes(o))},[a,C]),s=g.useMemo(()=>z.reduce((o,c)=>{const h=L(c.timestamp,"yyyy-MM-dd");return o[h]||(o[h]=[]),o[h].push(c),o},{}),[z]);return e.jsxs(R,{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Campaign Activity Timeline"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Chronological log of all actions across all contacts"})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(j,{type:"search",placeholder:"Search by contact name, event title, description, or type...",value:C,onChange:o=>S(o.target.value),className:"pl-11 bg-white border-gray-200 rounded-lg h-11 text-gray-900 placeholder:text-gray-400"})]}),e.jsx("div",{className:"space-y-6 max-h-[800px] overflow-y-auto pr-2",children:Object.entries(s).map(([o,c])=>{const h=new Date(o+"T00:00:00"),B=ct(h,new Date);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"sticky top-0 bg-white z-10 pb-2 mb-4 border-b border-gray-200",children:e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:B?"Today":L(h,"EEEE, MMMM d, yyyy")})}),e.jsxs("div",{className:"relative pl-8 space-y-4",children:[e.jsx("div",{className:"absolute left-3 top-0 bottom-0 w-0.5 bg-gray-200"}),c.map((i,A)=>{var se;const b=Q(i.type);c.length-1;const ee=r.has(i.id),Te=p.has(i.id),te=l.has(i.id),Me=i.status==="in-progress"&&!ee&&!Te&&!te;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute left-0 top-1.5 w-2 h-2 rounded-full border-2 ${Me?"bg-blue-500 border-blue-500 animate-pulse":d(i.status,i.id).includes("green")?"bg-green-500 border-green-500":d(i.status,i.id).includes("amber")?"bg-amber-500 border-amber-500":"bg-gray-400 border-gray-400"}`}),e.jsx("div",{className:`ml-6 p-4 rounded-lg border ${d(i.status,i.id)} transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(b,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:i.title}),e.jsx(k,{className:`${H(i.type)} text-xs`,children:i.type}),W(i.status,i.id)]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:i.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bt,{className:"h-3 w-3"}),e.jsx("span",{children:i.contactName})]}),e.jsx("span",{children:L(i.timestamp,"h:mm a")})]}),((se=i.metadata)==null?void 0:se.rating)&&e.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3 text-amber-500 fill-amber-500"}),e.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[i.metadata.rating,"/10"]}),e.jsx("div",{className:"flex gap-0.5 ml-2",children:Array.from({length:10}).map((Mt,ae)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${ae<i.metadata.rating?"bg-amber-500":"bg-gray-200"}`},ae))})]})]}),!te&&(i.status==="in-progress"||i.status==="scheduled")&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[i.status==="in-progress"&&e.jsx(w,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-500 hover:text-amber-600",onClick:()=>O(i.id),title:ee?"Resume":"Pause",children:e.jsx(X,{className:"h-3.5 w-3.5"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-500 hover:text-gray-700",onClick:()=>$(i.id),title:"Skip",children:e.jsx(ut,{className:"h-3.5 w-3.5"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-500 hover:text-red-600",onClick:()=>U(i.id),title:"Cancel",children:e.jsx(ht,{className:"h-3.5 w-3.5"})})]})]})})]},i.id)})]})]},o)})}),Object.keys(s).length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No events found matching your search."})})]})}function Ut(){const n=$e(),[,a]=Ue(),[r,x]=g.useState(null),[p,t]=g.useState(!1);if(g.useEffect(()=>{if(n.id){const u=Ke(n.id);u?x(u):a("/campaigns")}},[n.id,a]),!r)return e.jsx("div",{className:"min-h-full bg-gray-50 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Loading..."})});const{insights:l}=r;return e.jsxs("div",{className:"min-h-full bg-gray-50",children:[e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsx("div",{className:"max-w-6xl mx-auto px-8 py-5",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>a("/campaigns"),className:"text-gray-500 hover:text-gray-900 hover:bg-gray-100","data-testid":"button-back",children:e.jsx(ot,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900","data-testid":"text-campaign-name",children:r.name}),e.jsx(Ye,{status:r.status})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:r.description})]})]}),e.jsxs(w,{onClick:()=>t(!0),className:"bg-primary hover:bg-primary/90 text-white rounded-md","data-testid":"button-edit",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Settings"]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-8 py-6",children:e.jsxs(Ce,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gray-300 z-0"}),e.jsxs(Z,{className:"bg-transparent border-0 p-0 h-auto gap-0 relative z-10",children:[e.jsxs(T,{value:"dashboard",className:"relative px-6 py-3 bg-white text-gray-600 font-medium transition-all border-2 border-b-0 border-gray-300 data-[state=active]:bg-red-600 data-[state=active]:text-white data-[state=active]:border-red-600 data-[state=active]:z-20 data-[state=active]:shadow-[0_-4px_6px_rgba(0,0,0,0.1)] data-[state=inactive]:hover:bg-gray-50 data-[state=inactive]:z-10 data-[state=inactive]:border-gray-300",style:{clipPath:"polygon(0 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 0 100%)",marginBottom:"-2px"},children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Dashboard"]}),e.jsxs(T,{value:"log",className:"relative px-6 py-3 bg-white text-gray-600 font-medium transition-all border-2 border-b-0 border-gray-300 data-[state=active]:bg-red-600 data-[state=active]:text-white data-[state=active]:border-red-600 data-[state=active]:z-20 data-[state=active]:shadow-[0_-4px_6px_rgba(0,0,0,0.1)] data-[state=inactive]:hover:bg-gray-50 data-[state=inactive]:z-10 data-[state=inactive]:border-gray-300",style:{clipPath:"polygon(20px 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 0 100%, 0 20px)",marginBottom:"-2px",marginLeft:"-2px"},children:[e.jsx(mt,{className:"h-4 w-4 mr-2"}),"Campaign Log"]})]})]}),e.jsxs(M,{value:"dashboard",className:"space-y-6 mt-0",children:[e.jsxs(R,{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-primary"}),"Leads Source"]}),e.jsx("p",{className:"text-sm text-gray-500",children:r.targetAudience||"No description provided"})]}),r.aiAgentSettings.enabled&&e.jsx(At,{campaignId:r.id}),e.jsx(Y,{title:"History",icon:e.jsx(J,{className:"h-5 w-5"}),collapsible:!0,defaultExpanded:!0,children:r.aiAgentSettings.enabled?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Total Calls"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.aiAgentMetrics.totalCalls})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Successful"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:l.aiAgentMetrics.successfulCalls})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Unreachable"}),e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:l.aiAgentMetrics.unreachable})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Avg Duration"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[Math.floor(l.aiAgentMetrics.avgCallDuration/60),":",(l.aiAgentMetrics.avgCallDuration%60).toString().padStart(2,"0")]})]})]}),l.aiAgentMetrics.escalationReasons.length>0&&e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Escalation Reasons"}),e.jsx("div",{className:"space-y-3",children:l.aiAgentMetrics.escalationReasons.map(u=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:u.reason}),e.jsx("span",{className:"font-semibold text-gray-900",children:u.count})]},u.reason))})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"AI Agent is not enabled for this campaign."})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(gt,{className:"h-5 w-5 text-primary"}),"NPS Overview"]}),e.jsx(jt,{promotersPercent:l.promotersPercent,passivesPercent:l.passivesPercent,detractorsPercent:l.detractorsPercent,npsScore:l.npsScore}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900","data-testid":"text-response-count",children:l.responseCount}),e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Responses"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900","data-testid":"text-response-rate",children:[l.responseRate,"%"]}),e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Response Rate"})]})]})]}),e.jsxs(R,{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Response Sources"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{label:"Email",value:Math.round(l.responseSources.email/l.responseCount*100)||0,color:"#3B82F6",count:l.responseSources.email}),e.jsx(I,{label:"SMS",value:Math.round(l.responseSources.sms/l.responseCount*100)||0,color:"#A855F7",count:l.responseSources.sms}),e.jsx(I,{label:"AI Call",value:Math.round(l.responseSources.aiCall/l.responseCount*100)||0,color:"#F97316",count:l.responseSources.aiCall})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-4",children:"NPS Trend"}),e.jsx(yt,{data:l.npsOverTime})]})]})]}),e.jsxs(Y,{title:"Review Performance",icon:e.jsx(we,{className:"h-5 w-5"}),collapsible:!0,defaultExpanded:!1,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Review Requests Sent"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.reviewPerformance.totalReviewRequestsSent})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Click Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[l.reviewPerformance.clickRate,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1 uppercase tracking-wider",children:"Engagement Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[l.reviewPerformance.engagementRate,"%"]})]})]}),l.reviewPerformance.clicksByChannel.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Clicks by Channel"}),e.jsx("div",{className:"space-y-4",children:l.reviewPerformance.clicksByChannel.map(u=>e.jsx(I,{label:u.channel,value:Math.round(u.clicks/l.reviewPerformance.totalReviewRequestsSent*100),color:"#3B82F6",count:u.clicks},u.channel))})]}),l.reviewPerformance.clicksByPlatform.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Clicks by Platform"}),e.jsx("div",{className:"space-y-4",children:l.reviewPerformance.clicksByPlatform.map(u=>e.jsx(I,{label:u.platform,value:Math.round(u.clicks/l.reviewPerformance.totalReviewRequestsSent*100),color:"#4CAF50",count:u.clicks},u.platform))})]})]}),e.jsx(Y,{title:"Detractor Cases",icon:e.jsx(pt,{className:"h-5 w-5"}),collapsible:!0,defaultExpanded:!1,children:e.jsx(vt,{tickets:l.detractorTickets})})]}),e.jsx(M,{value:"log",className:"mt-0",children:e.jsx(Tt,{campaignId:r.id})})]})}),e.jsx(kt,{campaign:r,open:p,onOpenChange:t,onSave:u=>x(u)})]})}export{Ut as default};
